"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Authentik = void 0;
/**
 * Authentik Construct - CDK implementation of the Authentik service
 * Orchestrates the server, worker, and load balancer components
 */
const constructs_1 = require("constructs");
const aws_cdk_lib_1 = require("aws-cdk-lib");
const elb_1 = require("./elb");
const authentik_server_1 = require("./authentik-server");
const authentik_worker_1 = require("./authentik-worker");
/**
 * CDK construct for the Authentik service - orchestrates server, worker, and load balancer
 */
class Authentik extends constructs_1.Construct {
    constructor(scope, id, props) {
        super(scope, id);
        // Create the load balancer and networking
        const elb = new elb_1.Elb(this, 'ELB', {
            environment: props.environment,
            config: props.config,
            vpc: props.vpc,
            sslCertificateArn: props.sslCertificateArn
        });
        // Create the Authentik server
        const server = new authentik_server_1.AuthentikServer(this, 'Server', {
            environment: props.environment,
            config: props.config,
            vpc: props.vpc,
            ecsSecurityGroup: props.ecsSecurityGroup,
            ecsCluster: props.ecsCluster,
            s3ConfBucket: props.s3ConfBucket,
            envFileS3Uri: props.envFileS3Uri,
            envFileS3Key: props.envFileS3Key,
            adminUserEmail: props.adminUserEmail,
            ldapBaseDn: props.ldapBaseDn,
            useConfigFile: props.useConfigFile,
            ecrRepositoryArn: props.ecrRepositoryArn,
            enableExecute: props.enableExecute,
            dbSecret: props.dbSecret,
            dbHostname: props.dbHostname,
            redisAuthToken: props.redisAuthToken,
            redisHostname: props.redisHostname,
            secretKey: props.secretKey,
            adminUserPassword: props.adminUserPassword,
            adminUserToken: props.adminUserToken,
            ldapToken: props.ldapToken,
            efsId: props.efsId,
            efsMediaAccessPointId: props.efsMediaAccessPointId,
            efsCustomTemplatesAccessPointId: props.efsCustomTemplatesAccessPointId
        });
        // Create the Authentik worker
        const worker = new authentik_worker_1.AuthentikWorker(this, 'Worker', {
            environment: props.environment,
            config: props.config,
            vpc: props.vpc,
            ecsSecurityGroup: props.ecsSecurityGroup,
            ecsCluster: props.ecsCluster,
            s3ConfBucket: props.s3ConfBucket,
            envFileS3Key: props.envFileS3Key,
            ecrRepositoryArn: props.ecrRepositoryArn,
            enableExecute: props.enableExecute,
            dbSecret: props.dbSecret,
            dbHostname: props.dbHostname,
            redisAuthToken: props.redisAuthToken,
            redisHostname: props.redisHostname,
            secretKey: props.secretKey,
            efsId: props.efsId,
            efsMediaAccessPointId: props.efsMediaAccessPointId,
            efsCustomTemplatesAccessPointId: props.efsCustomTemplatesAccessPointId
        });
        // Connect the server to the load balancer
        server.createTargetGroup(props.vpc, elb.httpsListener);
        // Expose public properties
        this.loadBalancer = elb.loadBalancer;
        this.taskDefinition = server.taskDefinition;
        this.ecsService = server.ecsService;
        this.workerService = worker.ecsService;
        this.dnsName = elb.dnsName;
        // Export additional outputs
        new aws_cdk_lib_1.CfnOutput(this, 'AuthentikServerServiceName', {
            value: this.ecsService.serviceName,
            description: 'The name of the Authentik server ECS service'
        });
        new aws_cdk_lib_1.CfnOutput(this, 'AuthentikWorkerServiceName', {
            value: this.workerService.serviceName,
            description: 'The name of the Authentik worker ECS service'
        });
    }
}
exports.Authentik = Authentik;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aGVudGlrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiYXV0aGVudGlrLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBOzs7R0FHRztBQUNILDJDQUF1QztBQUN2Qyw2Q0FPcUI7QUFFckIsK0JBQTRCO0FBQzVCLHlEQUFxRDtBQUNyRCx5REFBcUQ7QUFvSXJEOztHQUVHO0FBQ0gsTUFBYSxTQUFVLFNBQVEsc0JBQVM7SUEwQnRDLFlBQVksS0FBZ0IsRUFBRSxFQUFVLEVBQUUsS0FBcUI7UUFDN0QsS0FBSyxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsQ0FBQztRQUVqQiwwQ0FBMEM7UUFDMUMsTUFBTSxHQUFHLEdBQUcsSUFBSSxTQUFHLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRTtZQUMvQixXQUFXLEVBQUUsS0FBSyxDQUFDLFdBQVc7WUFDOUIsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNO1lBQ3BCLEdBQUcsRUFBRSxLQUFLLENBQUMsR0FBRztZQUNkLGlCQUFpQixFQUFFLEtBQUssQ0FBQyxpQkFBaUI7U0FDM0MsQ0FBQyxDQUFDO1FBRUgsOEJBQThCO1FBQzlCLE1BQU0sTUFBTSxHQUFHLElBQUksa0NBQWUsQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFO1lBQ2pELFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztZQUM5QixNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU07WUFDcEIsR0FBRyxFQUFFLEtBQUssQ0FBQyxHQUFHO1lBQ2QsZ0JBQWdCLEVBQUUsS0FBSyxDQUFDLGdCQUFnQjtZQUN4QyxVQUFVLEVBQUUsS0FBSyxDQUFDLFVBQVU7WUFDNUIsWUFBWSxFQUFFLEtBQUssQ0FBQyxZQUFZO1lBQ2hDLFlBQVksRUFBRSxLQUFLLENBQUMsWUFBWTtZQUNoQyxZQUFZLEVBQUUsS0FBSyxDQUFDLFlBQVk7WUFDaEMsY0FBYyxFQUFFLEtBQUssQ0FBQyxjQUFjO1lBQ3BDLFVBQVUsRUFBRSxLQUFLLENBQUMsVUFBVTtZQUM1QixhQUFhLEVBQUUsS0FBSyxDQUFDLGFBQWE7WUFDbEMsZ0JBQWdCLEVBQUUsS0FBSyxDQUFDLGdCQUFnQjtZQUN4QyxhQUFhLEVBQUUsS0FBSyxDQUFDLGFBQWE7WUFDbEMsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRO1lBQ3hCLFVBQVUsRUFBRSxLQUFLLENBQUMsVUFBVTtZQUM1QixjQUFjLEVBQUUsS0FBSyxDQUFDLGNBQWM7WUFDcEMsYUFBYSxFQUFFLEtBQUssQ0FBQyxhQUFhO1lBQ2xDLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUztZQUMxQixpQkFBaUIsRUFBRSxLQUFLLENBQUMsaUJBQWlCO1lBQzFDLGNBQWMsRUFBRSxLQUFLLENBQUMsY0FBYztZQUNwQyxTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7WUFDMUIsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLO1lBQ2xCLHFCQUFxQixFQUFFLEtBQUssQ0FBQyxxQkFBcUI7WUFDbEQsK0JBQStCLEVBQUUsS0FBSyxDQUFDLCtCQUErQjtTQUN2RSxDQUFDLENBQUM7UUFFSCw4QkFBOEI7UUFDOUIsTUFBTSxNQUFNLEdBQUcsSUFBSSxrQ0FBZSxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUU7WUFDakQsV0FBVyxFQUFFLEtBQUssQ0FBQyxXQUFXO1lBQzlCLE1BQU0sRUFBRSxLQUFLLENBQUMsTUFBTTtZQUNwQixHQUFHLEVBQUUsS0FBSyxDQUFDLEdBQUc7WUFDZCxnQkFBZ0IsRUFBRSxLQUFLLENBQUMsZ0JBQWdCO1lBQ3hDLFVBQVUsRUFBRSxLQUFLLENBQUMsVUFBVTtZQUM1QixZQUFZLEVBQUUsS0FBSyxDQUFDLFlBQVk7WUFDaEMsWUFBWSxFQUFFLEtBQUssQ0FBQyxZQUFZO1lBQ2hDLGdCQUFnQixFQUFFLEtBQUssQ0FBQyxnQkFBZ0I7WUFDeEMsYUFBYSxFQUFFLEtBQUssQ0FBQyxhQUFhO1lBQ2xDLFFBQVEsRUFBRSxLQUFLLENBQUMsUUFBUTtZQUN4QixVQUFVLEVBQUUsS0FBSyxDQUFDLFVBQVU7WUFDNUIsY0FBYyxFQUFFLEtBQUssQ0FBQyxjQUFjO1lBQ3BDLGFBQWEsRUFBRSxLQUFLLENBQUMsYUFBYTtZQUNsQyxTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7WUFDMUIsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLO1lBQ2xCLHFCQUFxQixFQUFFLEtBQUssQ0FBQyxxQkFBcUI7WUFDbEQsK0JBQStCLEVBQUUsS0FBSyxDQUFDLCtCQUErQjtTQUN2RSxDQUFDLENBQUM7UUFFSCwwQ0FBMEM7UUFDMUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBRXZELDJCQUEyQjtRQUMzQixJQUFJLENBQUMsWUFBWSxHQUFHLEdBQUcsQ0FBQyxZQUFZLENBQUM7UUFDckMsSUFBSSxDQUFDLGNBQWMsR0FBRyxNQUFNLENBQUMsY0FBYyxDQUFDO1FBQzVDLElBQUksQ0FBQyxVQUFVLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQztRQUNwQyxJQUFJLENBQUMsYUFBYSxHQUFHLE1BQU0sQ0FBQyxVQUFVLENBQUM7UUFDdkMsSUFBSSxDQUFDLE9BQU8sR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDO1FBRTNCLDRCQUE0QjtRQUM1QixJQUFJLHVCQUFTLENBQUMsSUFBSSxFQUFFLDRCQUE0QixFQUFFO1lBQ2hELEtBQUssRUFBRSxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVc7WUFDbEMsV0FBVyxFQUFFLDhDQUE4QztTQUM1RCxDQUFDLENBQUM7UUFFSCxJQUFJLHVCQUFTLENBQUMsSUFBSSxFQUFFLDRCQUE0QixFQUFFO1lBQ2hELEtBQUssRUFBRSxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVc7WUFDckMsV0FBVyxFQUFFLDhDQUE4QztTQUM1RCxDQUFDLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUEzR0QsOEJBMkdDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBdXRoZW50aWsgQ29uc3RydWN0IC0gQ0RLIGltcGxlbWVudGF0aW9uIG9mIHRoZSBBdXRoZW50aWsgc2VydmljZVxuICogT3JjaGVzdHJhdGVzIHRoZSBzZXJ2ZXIsIHdvcmtlciwgYW5kIGxvYWQgYmFsYW5jZXIgY29tcG9uZW50c1xuICovXG5pbXBvcnQgeyBDb25zdHJ1Y3QgfSBmcm9tICdjb25zdHJ1Y3RzJztcbmltcG9ydCB7XG4gIGF3c19lYzIgYXMgZWMyLFxuICBhd3NfZWNzIGFzIGVjcyxcbiAgYXdzX2VsYXN0aWNsb2FkYmFsYW5jaW5ndjIgYXMgZWxidjIsXG4gIGF3c19zZWNyZXRzbWFuYWdlciBhcyBzZWNyZXRzbWFuYWdlcixcbiAgYXdzX3MzIGFzIHMzLFxuICBDZm5PdXRwdXRcbn0gZnJvbSAnYXdzLWNkay1saWInO1xuaW1wb3J0IHR5cGUgeyBBdXRoSW5mcmFFbnZpcm9ubWVudENvbmZpZyB9IGZyb20gJy4uL2Vudmlyb25tZW50LWNvbmZpZyc7XG5pbXBvcnQgeyBFbGIgfSBmcm9tICcuL2VsYic7XG5pbXBvcnQgeyBBdXRoZW50aWtTZXJ2ZXIgfSBmcm9tICcuL2F1dGhlbnRpay1zZXJ2ZXInO1xuaW1wb3J0IHsgQXV0aGVudGlrV29ya2VyIH0gZnJvbSAnLi9hdXRoZW50aWstd29ya2VyJztcblxuLyoqXG4gKiBQcm9wZXJ0aWVzIGZvciB0aGUgQXV0aGVudGlrIGNvbnN0cnVjdFxuICovXG5leHBvcnQgaW50ZXJmYWNlIEF1dGhlbnRpa1Byb3BzIHtcbiAgLyoqXG4gICAqIEVudmlyb25tZW50IG5hbWUgKGUuZy4gJ3Byb2QnLCAnZGV2JywgZXRjLilcbiAgICovXG4gIGVudmlyb25tZW50OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEVudmlyb25tZW50IGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIGNvbmZpZzogQXV0aEluZnJhRW52aXJvbm1lbnRDb25maWc7XG5cbiAgLyoqXG4gICAqIFZQQyBmb3IgZGVwbG95bWVudFxuICAgKi9cbiAgdnBjOiBlYzIuSVZwYztcblxuICAvKipcbiAgICogU2VjdXJpdHkgZ3JvdXAgZm9yIEVDUyB0YXNrc1xuICAgKi9cbiAgZWNzU2VjdXJpdHlHcm91cDogZWMyLlNlY3VyaXR5R3JvdXA7XG5cbiAgLyoqXG4gICAqIEVDUyBjbHVzdGVyXG4gICAqL1xuICBlY3NDbHVzdGVyOiBlY3MuSUNsdXN0ZXI7XG5cbiAgLyoqXG4gICAqIFMzIGNvbmZpZ3VyYXRpb24gYnVja2V0IGZvciBlbnZpcm9ubWVudCBmaWxlc1xuICAgKi9cbiAgczNDb25mQnVja2V0OiBzMy5JQnVja2V0O1xuXG4gIC8qKlxuICAgKiBTMyBVUkkgZm9yIHRoZSBlbnZpcm9ubWVudCBmaWxlIChvcHRpb25hbClcbiAgICovXG4gIGVudkZpbGVTM1VyaT86IHN0cmluZztcblxuICAvKipcbiAgICogUzMga2V5IGZvciB0aGUgZW52aXJvbm1lbnQgZmlsZSAob3B0aW9uYWwpXG4gICAqL1xuICBlbnZGaWxlUzNLZXk/OiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFNTTCBjZXJ0aWZpY2F0ZSBBUk4gZm9yIEhUVFBTXG4gICAqL1xuICBzc2xDZXJ0aWZpY2F0ZUFybjogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBdXRoZW50aWsgYWRtaW4gdXNlciBlbWFpbFxuICAgKi9cbiAgYWRtaW5Vc2VyRW1haWw6IHN0cmluZztcblxuICAvKipcbiAgICogTERBUCBiYXNlIEROXG4gICAqL1xuICBsZGFwQmFzZURuOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIFdoZXRoZXIgdG8gdXNlIGF1dGhlbnRpay1jb25maWcuZW52IGZpbGVcbiAgICovXG4gIHVzZUNvbmZpZ0ZpbGU6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIEVDUiByZXBvc2l0b3J5IEFSTiBmb3IgRUNSIGltYWdlc1xuICAgKi9cbiAgZWNyUmVwb3NpdG9yeUFybj86IHN0cmluZztcblxuICAvKipcbiAgICogQWxsb3cgU1NIIGV4ZWMgaW50byBjb250YWluZXJcbiAgICovXG4gIGVuYWJsZUV4ZWN1dGU6IGJvb2xlYW47XG5cbiAgLyoqXG4gICAqIERhdGFiYXNlIGNyZWRlbnRpYWxzIHNlY3JldFxuICAgKi9cbiAgZGJTZWNyZXQ6IHNlY3JldHNtYW5hZ2VyLlNlY3JldDtcblxuICAvKipcbiAgICogRGF0YWJhc2UgaG9zdG5hbWVcbiAgICovXG4gIGRiSG9zdG5hbWU6IHN0cmluZztcblxuICAvKipcbiAgICogUmVkaXMgYXV0aCB0b2tlbiBzZWNyZXRcbiAgICovXG4gIHJlZGlzQXV0aFRva2VuOiBzZWNyZXRzbWFuYWdlci5TZWNyZXQ7XG5cbiAgLyoqXG4gICAqIFJlZGlzIGhvc3RuYW1lXG4gICAqL1xuICByZWRpc0hvc3RuYW1lOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEF1dGhlbnRpayBzZWNyZXQga2V5XG4gICAqL1xuICBzZWNyZXRLZXk6IHNlY3JldHNtYW5hZ2VyLlNlY3JldDtcblxuICAvKipcbiAgICogQWRtaW4gdXNlciBwYXNzd29yZCBzZWNyZXRcbiAgICovXG4gIGFkbWluVXNlclBhc3N3b3JkOiBzZWNyZXRzbWFuYWdlci5TZWNyZXQ7XG5cbiAgLyoqXG4gICAqIEFkbWluIHVzZXIgdG9rZW4gc2VjcmV0XG4gICAqL1xuICBhZG1pblVzZXJUb2tlbjogc2VjcmV0c21hbmFnZXIuU2VjcmV0O1xuXG4gIC8qKlxuICAgKiBMREFQIHRva2VuIHNlY3JldFxuICAgKi9cbiAgbGRhcFRva2VuOiBzZWNyZXRzbWFuYWdlci5TZWNyZXQ7XG5cbiAgLyoqXG4gICAqIEVGUyBmaWxlc3lzdGVtIElEXG4gICAqL1xuICBlZnNJZDogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBFRlMgYWNjZXNzIHBvaW50IElEIGZvciBtZWRpYVxuICAgKi9cbiAgZWZzTWVkaWFBY2Nlc3NQb2ludElkOiBzdHJpbmc7XG5cbiAgLyoqXG4gICAqIEVGUyBhY2Nlc3MgcG9pbnQgSUQgZm9yIGN1c3RvbSB0ZW1wbGF0ZXNcbiAgICovXG4gIGVmc0N1c3RvbVRlbXBsYXRlc0FjY2Vzc1BvaW50SWQ6IHN0cmluZztcbn1cblxuLyoqXG4gKiBDREsgY29uc3RydWN0IGZvciB0aGUgQXV0aGVudGlrIHNlcnZpY2UgLSBvcmNoZXN0cmF0ZXMgc2VydmVyLCB3b3JrZXIsIGFuZCBsb2FkIGJhbGFuY2VyXG4gKi9cbmV4cG9ydCBjbGFzcyBBdXRoZW50aWsgZXh0ZW5kcyBDb25zdHJ1Y3Qge1xuICAvKipcbiAgICogVGhlIGxvYWQgYmFsYW5jZXIgZm9yIHRoZSBBdXRoZW50aWsgc2VydmljZVxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGxvYWRCYWxhbmNlcjogZWxidjIuQXBwbGljYXRpb25Mb2FkQmFsYW5jZXI7XG5cbiAgLyoqXG4gICAqIFRoZSBFQ1MgdGFzayBkZWZpbml0aW9uIGZvciB0aGUgQXV0aGVudGlrIHNlcnZlclxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHRhc2tEZWZpbml0aW9uOiBlY3MuVGFza0RlZmluaXRpb247XG5cbiAgLyoqXG4gICAqIFRoZSBFQ1Mgc2VydmljZSBmb3IgQXV0aGVudGlrIHNlcnZlclxuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IGVjc1NlcnZpY2U6IGVjcy5GYXJnYXRlU2VydmljZTtcblxuICAvKipcbiAgICogVGhlIEVDUyBzZXJ2aWNlIGZvciBBdXRoZW50aWsgd29ya2Vyc1xuICAgKi9cbiAgcHVibGljIHJlYWRvbmx5IHdvcmtlclNlcnZpY2U6IGVjcy5GYXJnYXRlU2VydmljZTtcblxuICAvKipcbiAgICogRE5TIG5hbWUgb2YgdGhlIGxvYWQgYmFsYW5jZXJcbiAgICovXG4gIHB1YmxpYyByZWFkb25seSBkbnNOYW1lOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IEF1dGhlbnRpa1Byb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkKTtcblxuICAgIC8vIENyZWF0ZSB0aGUgbG9hZCBiYWxhbmNlciBhbmQgbmV0d29ya2luZ1xuICAgIGNvbnN0IGVsYiA9IG5ldyBFbGIodGhpcywgJ0VMQicsIHtcbiAgICAgIGVudmlyb25tZW50OiBwcm9wcy5lbnZpcm9ubWVudCxcbiAgICAgIGNvbmZpZzogcHJvcHMuY29uZmlnLFxuICAgICAgdnBjOiBwcm9wcy52cGMsXG4gICAgICBzc2xDZXJ0aWZpY2F0ZUFybjogcHJvcHMuc3NsQ2VydGlmaWNhdGVBcm5cbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSB0aGUgQXV0aGVudGlrIHNlcnZlclxuICAgIGNvbnN0IHNlcnZlciA9IG5ldyBBdXRoZW50aWtTZXJ2ZXIodGhpcywgJ1NlcnZlcicsIHtcbiAgICAgIGVudmlyb25tZW50OiBwcm9wcy5lbnZpcm9ubWVudCxcbiAgICAgIGNvbmZpZzogcHJvcHMuY29uZmlnLFxuICAgICAgdnBjOiBwcm9wcy52cGMsXG4gICAgICBlY3NTZWN1cml0eUdyb3VwOiBwcm9wcy5lY3NTZWN1cml0eUdyb3VwLFxuICAgICAgZWNzQ2x1c3RlcjogcHJvcHMuZWNzQ2x1c3RlcixcbiAgICAgIHMzQ29uZkJ1Y2tldDogcHJvcHMuczNDb25mQnVja2V0LFxuICAgICAgZW52RmlsZVMzVXJpOiBwcm9wcy5lbnZGaWxlUzNVcmksXG4gICAgICBlbnZGaWxlUzNLZXk6IHByb3BzLmVudkZpbGVTM0tleSxcbiAgICAgIGFkbWluVXNlckVtYWlsOiBwcm9wcy5hZG1pblVzZXJFbWFpbCxcbiAgICAgIGxkYXBCYXNlRG46IHByb3BzLmxkYXBCYXNlRG4sXG4gICAgICB1c2VDb25maWdGaWxlOiBwcm9wcy51c2VDb25maWdGaWxlLFxuICAgICAgZWNyUmVwb3NpdG9yeUFybjogcHJvcHMuZWNyUmVwb3NpdG9yeUFybixcbiAgICAgIGVuYWJsZUV4ZWN1dGU6IHByb3BzLmVuYWJsZUV4ZWN1dGUsXG4gICAgICBkYlNlY3JldDogcHJvcHMuZGJTZWNyZXQsXG4gICAgICBkYkhvc3RuYW1lOiBwcm9wcy5kYkhvc3RuYW1lLFxuICAgICAgcmVkaXNBdXRoVG9rZW46IHByb3BzLnJlZGlzQXV0aFRva2VuLFxuICAgICAgcmVkaXNIb3N0bmFtZTogcHJvcHMucmVkaXNIb3N0bmFtZSxcbiAgICAgIHNlY3JldEtleTogcHJvcHMuc2VjcmV0S2V5LFxuICAgICAgYWRtaW5Vc2VyUGFzc3dvcmQ6IHByb3BzLmFkbWluVXNlclBhc3N3b3JkLFxuICAgICAgYWRtaW5Vc2VyVG9rZW46IHByb3BzLmFkbWluVXNlclRva2VuLFxuICAgICAgbGRhcFRva2VuOiBwcm9wcy5sZGFwVG9rZW4sXG4gICAgICBlZnNJZDogcHJvcHMuZWZzSWQsXG4gICAgICBlZnNNZWRpYUFjY2Vzc1BvaW50SWQ6IHByb3BzLmVmc01lZGlhQWNjZXNzUG9pbnRJZCxcbiAgICAgIGVmc0N1c3RvbVRlbXBsYXRlc0FjY2Vzc1BvaW50SWQ6IHByb3BzLmVmc0N1c3RvbVRlbXBsYXRlc0FjY2Vzc1BvaW50SWRcbiAgICB9KTtcblxuICAgIC8vIENyZWF0ZSB0aGUgQXV0aGVudGlrIHdvcmtlclxuICAgIGNvbnN0IHdvcmtlciA9IG5ldyBBdXRoZW50aWtXb3JrZXIodGhpcywgJ1dvcmtlcicsIHtcbiAgICAgIGVudmlyb25tZW50OiBwcm9wcy5lbnZpcm9ubWVudCxcbiAgICAgIGNvbmZpZzogcHJvcHMuY29uZmlnLFxuICAgICAgdnBjOiBwcm9wcy52cGMsXG4gICAgICBlY3NTZWN1cml0eUdyb3VwOiBwcm9wcy5lY3NTZWN1cml0eUdyb3VwLFxuICAgICAgZWNzQ2x1c3RlcjogcHJvcHMuZWNzQ2x1c3RlcixcbiAgICAgIHMzQ29uZkJ1Y2tldDogcHJvcHMuczNDb25mQnVja2V0LFxuICAgICAgZW52RmlsZVMzS2V5OiBwcm9wcy5lbnZGaWxlUzNLZXksXG4gICAgICBlY3JSZXBvc2l0b3J5QXJuOiBwcm9wcy5lY3JSZXBvc2l0b3J5QXJuLFxuICAgICAgZW5hYmxlRXhlY3V0ZTogcHJvcHMuZW5hYmxlRXhlY3V0ZSxcbiAgICAgIGRiU2VjcmV0OiBwcm9wcy5kYlNlY3JldCxcbiAgICAgIGRiSG9zdG5hbWU6IHByb3BzLmRiSG9zdG5hbWUsXG4gICAgICByZWRpc0F1dGhUb2tlbjogcHJvcHMucmVkaXNBdXRoVG9rZW4sXG4gICAgICByZWRpc0hvc3RuYW1lOiBwcm9wcy5yZWRpc0hvc3RuYW1lLFxuICAgICAgc2VjcmV0S2V5OiBwcm9wcy5zZWNyZXRLZXksXG4gICAgICBlZnNJZDogcHJvcHMuZWZzSWQsXG4gICAgICBlZnNNZWRpYUFjY2Vzc1BvaW50SWQ6IHByb3BzLmVmc01lZGlhQWNjZXNzUG9pbnRJZCxcbiAgICAgIGVmc0N1c3RvbVRlbXBsYXRlc0FjY2Vzc1BvaW50SWQ6IHByb3BzLmVmc0N1c3RvbVRlbXBsYXRlc0FjY2Vzc1BvaW50SWRcbiAgICB9KTtcblxuICAgIC8vIENvbm5lY3QgdGhlIHNlcnZlciB0byB0aGUgbG9hZCBiYWxhbmNlclxuICAgIHNlcnZlci5jcmVhdGVUYXJnZXRHcm91cChwcm9wcy52cGMsIGVsYi5odHRwc0xpc3RlbmVyKTtcblxuICAgIC8vIEV4cG9zZSBwdWJsaWMgcHJvcGVydGllc1xuICAgIHRoaXMubG9hZEJhbGFuY2VyID0gZWxiLmxvYWRCYWxhbmNlcjtcbiAgICB0aGlzLnRhc2tEZWZpbml0aW9uID0gc2VydmVyLnRhc2tEZWZpbml0aW9uO1xuICAgIHRoaXMuZWNzU2VydmljZSA9IHNlcnZlci5lY3NTZXJ2aWNlO1xuICAgIHRoaXMud29ya2VyU2VydmljZSA9IHdvcmtlci5lY3NTZXJ2aWNlO1xuICAgIHRoaXMuZG5zTmFtZSA9IGVsYi5kbnNOYW1lO1xuXG4gICAgLy8gRXhwb3J0IGFkZGl0aW9uYWwgb3V0cHV0c1xuICAgIG5ldyBDZm5PdXRwdXQodGhpcywgJ0F1dGhlbnRpa1NlcnZlclNlcnZpY2VOYW1lJywge1xuICAgICAgdmFsdWU6IHRoaXMuZWNzU2VydmljZS5zZXJ2aWNlTmFtZSxcbiAgICAgIGRlc2NyaXB0aW9uOiAnVGhlIG5hbWUgb2YgdGhlIEF1dGhlbnRpayBzZXJ2ZXIgRUNTIHNlcnZpY2UnXG4gICAgfSk7XG5cbiAgICBuZXcgQ2ZuT3V0cHV0KHRoaXMsICdBdXRoZW50aWtXb3JrZXJTZXJ2aWNlTmFtZScsIHtcbiAgICAgIHZhbHVlOiB0aGlzLndvcmtlclNlcnZpY2Uuc2VydmljZU5hbWUsXG4gICAgICBkZXNjcmlwdGlvbjogJ1RoZSBuYW1lIG9mIHRoZSBBdXRoZW50aWsgd29ya2VyIEVDUyBzZXJ2aWNlJ1xuICAgIH0pO1xuICB9XG59XG4iXX0=