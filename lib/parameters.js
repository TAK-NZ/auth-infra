"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DOCKER_IMAGE_LOCATION = exports.USE_AUTHENTIK_CONFIG_FILE = exports.SSL_CERTIFICATE_ARN = exports.IP_ADDRESS_TYPE = exports.AUTHENTIK_LDAP_BASE_DN = exports.AUTHENTIK_ADMIN_USER_EMAIL = exports.ENABLE_EXECUTE = exports.GIT_SHA = exports.STACK_NAME = exports.ENV_TYPE = void 0;
exports.getGitSha = getGitSha;
exports.getParameters = getParameters;
exports.resolveStackParameters = resolveStackParameters;
const child_process_1 = require("child_process");
const environment_config_1 = require("./environment-config");
// Direct parameter exports following the reference pattern
exports.ENV_TYPE = process.env.ENV_TYPE || 'dev-test';
exports.STACK_NAME = process.env.STACK_NAME;
exports.GIT_SHA = process.env.GIT_SHA;
exports.ENABLE_EXECUTE = process.env.ENABLE_EXECUTE;
exports.AUTHENTIK_ADMIN_USER_EMAIL = process.env.AUTHENTIK_ADMIN_USER_EMAIL;
exports.AUTHENTIK_LDAP_BASE_DN = process.env.AUTHENTIK_LDAP_BASE_DN;
exports.IP_ADDRESS_TYPE = process.env.IP_ADDRESS_TYPE;
exports.SSL_CERTIFICATE_ARN = process.env.SSL_CERTIFICATE_ARN;
exports.USE_AUTHENTIK_CONFIG_FILE = process.env.USE_AUTHENTIK_CONFIG_FILE;
exports.DOCKER_IMAGE_LOCATION = process.env.DOCKER_IMAGE_LOCATION;
/**
 * Get the current git SHA for tagging resources
 * @returns Current git SHA
 */
function getGitSha() {
    try {
        // Get the current git SHA
        return (0, child_process_1.execSync)('git rev-parse --short HEAD').toString().trim();
    }
    catch (error) {
        console.warn('Unable to get git SHA, using "development"');
        return 'development';
    }
}
function getParameters() {
    return {
        envType: exports.ENV_TYPE,
        stackName: exports.STACK_NAME || 'MyFirstStack',
        gitSha: exports.GIT_SHA || getGitSha(),
        enableExecute: exports.ENABLE_EXECUTE === 'true' || false,
    };
}
/**
 * Resolves all AuthInfra stack parameters using cascading resolution
 * Priority: 1. Environment Variables, 2. CDK Context, 3. Default Values
 */
function resolveStackParameters(stack) {
    // Environment variables (first priority)
    const STACK_NAME_ENV = process.env.STACK_NAME;
    // Context values (second priority)
    const envTypeFromContext = stack.node.tryGetContext('envType');
    const stackNameFromContext = stack.node.tryGetContext('stackName');
    const gitShaFromContext = stack.node.tryGetContext('gitSha');
    const enableExecuteFromContext = stack.node.tryGetContext('enableExecute');
    const authentikAdminUserEmailFromContext = stack.node.tryGetContext('authentikAdminUserEmail');
    const authentikLdapBaseDnFromContext = stack.node.tryGetContext('authentikLdapBaseDn');
    const ipAddressTypeFromContext = stack.node.tryGetContext('ipAddressType');
    const sslCertificateArnFromContext = stack.node.tryGetContext('sslCertificateArn');
    const useAuthentikConfigFileFromContext = stack.node.tryGetContext('useAuthentikConfigFile');
    const dockerImageLocationFromContext = stack.node.tryGetContext('dockerImageLocation');
    const authentikHostFromContext = stack.node.tryGetContext('authentikHost');
    // Resolution with environment variables taking precedence
    const envType = process.env.ENV_TYPE || envTypeFromContext || 'dev-test';
    const stackName = STACK_NAME_ENV || stackNameFromContext || `${envType}-stack`;
    const gitSha = exports.GIT_SHA || gitShaFromContext || getGitSha();
    // Get environment-specific configuration
    const envConfig = (0, environment_config_1.getEnvironmentConfig)(envType);
    // Boolean parameters: Environment variables override context, which overrides defaults
    const enableExecute = exports.ENABLE_EXECUTE !== undefined
        ? Boolean(exports.ENABLE_EXECUTE === 'true')
        : enableExecuteFromContext !== undefined
            ? Boolean(enableExecuteFromContext)
            : false;
    const useAuthentikConfigFile = exports.USE_AUTHENTIK_CONFIG_FILE !== undefined
        ? Boolean(exports.USE_AUTHENTIK_CONFIG_FILE === 'true')
        : useAuthentikConfigFileFromContext !== undefined
            ? Boolean(useAuthentikConfigFileFromContext)
            : false;
    // String parameters with validation
    const authentikAdminUserEmail = exports.AUTHENTIK_ADMIN_USER_EMAIL || authentikAdminUserEmailFromContext || '';
    const authentikLdapBaseDn = exports.AUTHENTIK_LDAP_BASE_DN || authentikLdapBaseDnFromContext || 'DC=example,DC=com';
    const ipAddressType = (exports.IP_ADDRESS_TYPE || ipAddressTypeFromContext || 'dualstack');
    const sslCertificateArn = exports.SSL_CERTIFICATE_ARN || sslCertificateArnFromContext || '';
    const dockerImageLocation = (exports.DOCKER_IMAGE_LOCATION || dockerImageLocationFromContext || 'Github');
    // For LDAP, the authentik host will be derived from the Authentik construct within the same stack
    // This is a placeholder that gets overridden during stack construction
    const authentikHost = process.env.AUTHENTIK_HOST || authentikHostFromContext || 'localhost';
    // Validate required parameters
    if (!authentikAdminUserEmail) {
        throw new Error('authentikAdminUserEmail is required. Set it via --context authentikAdminUserEmail=user@example.com or AUTHENTIK_ADMIN_USER_EMAIL environment variable.');
    }
    return {
        envType,
        stackName,
        gitSha,
        enableExecute,
        authentikAdminUserEmail,
        authentikLdapBaseDn,
        ipAddressType,
        sslCertificateArn,
        useAuthentikConfigFile,
        dockerImageLocation,
        authentikHost,
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyYW1ldGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInBhcmFtZXRlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBdUJBLDhCQVFDO0FBRUQsc0NBT0M7QUFNRCx3REErRUM7QUF6SEQsaURBQXlDO0FBQ3pDLDZEQUE0RDtBQUU1RCwyREFBMkQ7QUFDOUMsUUFBQSxRQUFRLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUErQixJQUFJLFVBQVUsQ0FBQztBQUNyRSxRQUFBLFVBQVUsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQztBQUNwQyxRQUFBLE9BQU8sR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQztBQUM5QixRQUFBLGNBQWMsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQztBQUM1QyxRQUFBLDBCQUEwQixHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUM7QUFDcEUsUUFBQSxzQkFBc0IsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLHNCQUFzQixDQUFDO0FBQzVELFFBQUEsZUFBZSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDO0FBQzlDLFFBQUEsbUJBQW1CLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQztBQUN0RCxRQUFBLHlCQUF5QixHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMseUJBQXlCLENBQUM7QUFDbEUsUUFBQSxxQkFBcUIsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDO0FBRXZFOzs7R0FHRztBQUNILFNBQWdCLFNBQVM7SUFDdkIsSUFBSSxDQUFDO1FBQ0gsMEJBQTBCO1FBQzFCLE9BQU8sSUFBQSx3QkFBUSxFQUFDLDRCQUE0QixDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDbEUsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZixPQUFPLENB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LHVCQUF1QixHQUFHLGtDQUEwQixJQUFJLGtDQUFrQyxJQUFJLEVBQUUsQ0FBQztJQUN2RyxNQUFNLG1CQUFtQixHQUFHLDhCQUFzQixJQUFJLDhCQUE4QixJQUFJLG1CQUFtQixDQUFDO0lBQzVHLE1BQU0sYUFBYSxHQUFHLENBQUMsdUJBQWUsSUFBSSx3QkFBd0IsSUFBSSxXQUFXLENBQXlCLENBQUM7SUFDM0csTUFBTSxpQkFBaUIsR0FBRywyQkFBbUIsSUFBSSw0QkFBNEIsSUFBSSxFQUFFLENBQUM7SUFDcEYsTUFBTSxtQkFBbUIsR0FBRyxDQUFDLDZCQUFxQixJQUFJLDhCQUE4QixJQUFJLFFBQVEsQ0FBMkIsQ0FBQztJQUU1SCxrR0FBa0c7SUFDbEcsdUVBQXVFO0lBQ3ZFLE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxJQUFJLHdCQUF3QixJQUFJLFdBQVcsQ0FBQztJQUU1RiwrQkFBK0I7SUFDL0IsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUM7UUFDN0IsTUFBTSxJQUFJLEtBQUssQ0FBQyx3SkFBd0osQ0FBQyxDQUFDO0lBQzVLLENBQUM7SUFFRCxPQUFPO1FBQ0wsT0FBTztRQUNQLFNBQVM7UUFDVCxNQUFNO1FBQ04sYUFBYTtRQUNiLHVCQUF1QjtRQUN2QixtQkFBbUI7UUFDbkIsYUFBYTtRQUNiLGlCQUFpQjtRQUNqQixzQkFBc0I7UUFDdEIsbUJBQW1CO1FBQ25CLGFBQWE7S0FDZCxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogUGFyYW1ldGVyIGhhbmRsaW5nIGFuZCBlbnZpcm9ubWVudCB2YXJpYWJsZSByZXNvbHV0aW9uIGZvciB0aGUgQXV0aEluZnJhIHN0YWNrXG4gKi9cbmltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0IHsgZ2V0RW52aXJvbm1lbnRDb25maWcgfSBmcm9tICcuL2Vudmlyb25tZW50LWNvbmZpZyc7XG5cbi8vIERpcmVjdCBwYXJhbWV0ZXIgZXhwb3J0cyBmb2xsb3dpbmcgdGhlIHJlZmVyZW5jZSBwYXR0ZXJuXG5leHBvcnQgY29uc3QgRU5WX1RZUEUgPSBwcm9jZXNzLmVudi5FTlZfVFlQRSBhcyAncHJvZCcgfCAnZGV2LXRlc3QnIHx8ICdkZXYtdGVzdCc7XG5leHBvcnQgY29uc3QgU1RBQ0tfTkFNRSA9IHByb2Nlc3MuZW52LlNUQUNLX05BTUU7XG5leHBvcnQgY29uc3QgR0lUX1NIQSA9IHByb2Nlc3MuZW52LkdJVF9TSEE7XG5leHBvcnQgY29uc3QgRU5BQkxFX0VYRUNVVEUgPSBwcm9jZXNzLmVudi5FTkFCTEVfRVhFQ1VURTtcbmV4cG9ydCBjb25zdCBBVVRIRU5USUtfQURNSU5fVVNFUl9FTUFJTCA9IHByb2Nlc3MuZW52LkFVVEhFTlRJS19BRE1JTl9VU0VSX0VNQUlMO1xuZXhwb3J0IGNvbnN0IEFVVEhFTlRJS19MREFQX0JBU0VfRE4gPSBwcm9jZXNzLmVudi5BVVRIRU5USUtfTERBUF9CQVNFX0ROO1xuZXhwb3J0IGNvbnN0IElQX0FERFJFU1NfVFlQRSA9IHByb2Nlc3MuZW52LklQX0FERFJFU1NfVFlQRTtcbmV4cG9ydCBjb25zdCBTU0xfQ0VSVElGSUNBVEVfQVJOID0gcHJvY2Vzcy5lbnYuU1NMX0NFUlRJRklDQVRFX0FSTjtcbmV4cG9ydCBjb25zdCBVU0VfQVVUSEVOVElLX0NPTkZJR19GSUxFID0gcHJvY2Vzcy5lbnYuVVNFX0FVVEhFTlRJS19DT05GSUdfRklMRTtcbmV4cG9ydCBjb25zdCBET0NLRVJfSU1BR0VfTE9DQVRJT04gPSBwcm9jZXNzLmVudi5ET0NLRVJfSU1BR0VfTE9DQVRJT047XG5cbi8qKlxuICogR2V0IHRoZSBjdXJyZW50IGdpdCBTSEEgZm9yIHRhZ2dpbmcgcmVzb3VyY2VzXG4gKiBAcmV0dXJucyBDdXJyZW50IGdpdCBTSEFcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEdpdFNoYSgpOiBzdHJpbmcge1xuICB0cnkge1xuICAgIC8vIEdldCB0aGUgY3VycmVudCBnaXQgU0hBXG4gICAgcmV0dXJuIGV4ZWNTeW5jKCdnaXQgcmV2LXBhcnNlIC0tc2hvcnQgSEVBRCcpLnRvU3RyaW5nKCkudHJpbSgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUud2FybignVW5hYmxlIHRvIGdldCBnaXQgU0hBLCB1c2luZyBcImRldmVsb3BtZW50XCInKTtcbiAgICByZXR1cm4gJ2RldmVsb3BtZW50JztcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UGFyYW1ldGVycygpIHtcbiAgcmV0dXJuIHtcbiAgICBlbnZUeXBlOiBFTlZfVFlQRSxcbiAgICBzdGFja05hbWU6IFNUQUNLX05BTUUgfHwgJ015Rmlyc3RTdGFjaycsXG4gICAgZ2l0U2hhOiBHSVRfU0hBIHx8IGdldEdpdFNoYSgpLFxuICAgIGVuYWJsZUV4ZWN1dGU6IEVOQUJMRV9FWEVDVVRFID09PSAndHJ1ZScgfHwgZmFsc2UsXG4gIH07XG59XG5cbi8qKlxuICogUmVzb2x2ZXMgYWxsIEF1dGhJbmZyYSBzdGFjayBwYXJhbWV0ZXJzIHVzaW5nIGNhc2NhZGluZyByZXNvbHV0aW9uXG4gKiBQcmlvcml0eTogMS4gRW52aXJvbm1lbnQgVmFyaWFibGVzLCAyLiBDREsgQ29udGV4dCwgMy4gRGVmYXVsdCBWYWx1ZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVTdGFja1BhcmFtZXRlcnMoc3RhY2s6IGNkay5TdGFjayk6IHtcbiAgZW52VHlwZTogc3RyaW5nO1xuICBzdGFja05hbWU6IHN0cmluZztcbiAgZ2l0U2hhOiBzdHJpbmc7XG4gIGVuYWJsZUV4ZWN1dGU6IGJvb2xlYW47XG4gIGF1dGhlbnRpa0FkbWluVXNlckVtYWlsOiBzdHJpbmc7XG4gIGF1dGhlbnRpa0xkYXBCYXNlRG46IHN0cmluZztcbiAgaXBBZGRyZXNzVHlwZTogJ2lwdjQnIHwgJ2R1YWxzdGFjayc7XG4gIHNzbENlcnRpZmljYXRlQXJuOiBzdHJpbmc7XG4gIHVzZUF1dGhlbnRpa0NvbmZpZ0ZpbGU6IGJvb2xlYW47XG4gIGRvY2tlckltYWdlTG9jYXRpb246ICdHaXRodWInIHwgJ0xvY2FsIEVDUic7XG4gIGF1dGhlbnRpa0hvc3Q6IHN0cmluZztcbn0ge1xuICAvLyBFbnZpcm9ubWVudCB2YXJpYWJsZXMgKGZpcnN0IHByaW9yaXR5KVxuICBjb25zdCBTVEFDS19OQU1FX0VOViA9IHByb2Nlc3MuZW52LlNUQUNLX05BTUU7XG4gIFxuICAvLyBDb250ZXh0IHZhbHVlcyAoc2Vjb25kIHByaW9yaXR5KVxuICBjb25zdCBlbnZUeXBlRnJvbUNvbnRleHQgPSBzdGFjay5ub2RlLnRyeUdldENvbnRleHQoJ2VudlR5cGUnKTtcbiAgY29uc3Qgc3RhY2tOYW1lRnJvbUNvbnRleHQgPSBzdGFjay5ub2RlLnRyeUdldENvbnRleHQoJ3N0YWNrTmFtZScpO1xuICBjb25zdCBnaXRTaGFGcm9tQ29udGV4dCA9IHN0YWNrLm5vZGUudHJ5R2V0Q29udGV4dCgnZ2l0U2hhJyk7XG4gIGNvbnN0IGVuYWJsZUV4ZWN1dGVGcm9tQ29udGV4dCA9IHN0YWNrLm5vZGUudHJ5R2V0Q29udGV4dCgnZW5hYmxlRXhlY3V0ZScpO1xuICBjb25zdCBhdXRoZW50aWtBZG1pblVzZXJFbWFpbEZyb21Db250ZXh0ID0gc3RhY2subm9kZS50cnlHZXRDb250ZXh0KCdhdXRoZW50aWtBZG1pblVzZXJFbWFpbCcpO1xuICBjb25zdCBhdXRoZW50aWtMZGFwQmFzZURuRnJvbUNvbnRleHQgPSBzdGFjay5ub2RlLnRyeUdldENvbnRleHQoJ2F1dGhlbnRpa0xkYXBCYXNlRG4nKTtcbiAgY29uc3QgaXBBZGRyZXNzVHlwZUZyb21Db250ZXh0ID0gc3RhY2subm9kZS50cnlHZXRDb250ZXh0KCdpcEFkZHJlc3NUeXBlJyk7XG4gIGNvbnN0IHNzbENlcnRpZmljYXRlQXJuRnJvbUNvbnRleHQgPSBzdGFjay5ub2RlLnRyeUdldENvbnRleHQoJ3NzbENlcnRpZmljYXRlQXJuJyk7XG4gIGNvbnN0IHVzZUF1dGhlbnRpa0NvbmZpZ0ZpbGVGcm9tQ29udGV4dCA9IHN0YWNrLm5vZGUudHJ5R2V0Q29udGV4dCgndXNlQXV0aGVudGlrQ29uZmlnRmlsZScpO1xuICBjb25zdCBkb2NrZXJJbWFnZUxvY2F0aW9uRnJvbUNvbnRleHQgPSBzdGFjay5ub2RlLnRyeUdldENvbnRleHQoJ2RvY2tlckltYWdlTG9jYXRpb24nKTtcbiAgY29uc3QgYXV0aGVudGlrSG9zdEZyb21Db250ZXh0ID0gc3RhY2subm9kZS50cnlHZXRDb250ZXh0KCdhdXRoZW50aWtIb3N0Jyk7XG5cbiAgLy8gUmVzb2x1dGlvbiB3aXRoIGVudmlyb25tZW50IHZhcmlhYmxlcyB0YWtpbmcgcHJlY2VkZW5jZVxuICBjb25zdCBlbnZUeXBlID0gcHJvY2Vzcy5lbnYuRU5WX1RZUEUgfHwgZW52VHlwZUZyb21Db250ZXh0IHx8ICdkZXYtdGVzdCc7XG4gIGNvbnN0IHN0YWNrTmFtZSA9IFNUQUNLX05BTUVfRU5WIHx8IHN0YWNrTmFtZUZyb21Db250ZXh0IHx8IGAke2VudlR5cGV9LXN0YWNrYDtcbiAgY29uc3QgZ2l0U2hhID0gR0lUX1NIQSB8fCBnaXRTaGFGcm9tQ29udGV4dCB8fCBnZXRHaXRTaGEoKTtcblxuICAvLyBHZXQgZW52aXJvbm1lbnQtc3BlY2lmaWMgY29uZmlndXJhdGlvblxuICBjb25zdCBlbnZDb25maWcgPSBnZXRFbnZpcm9ubWVudENvbmZpZyhlbnZUeXBlKTtcblxuICAvLyBCb29sZWFuIHBhcmFtZXRlcnM6IEVudmlyb25tZW50IHZhcmlhYmxlcyBvdmVycmlkZSBjb250ZXh0LCB3aGljaCBvdmVycmlkZXMgZGVmYXVsdHNcbiAgY29uc3QgZW5hYmxlRXhlY3V0ZSA9IEVOQUJMRV9FWEVDVVRFICE9PSB1bmRlZmluZWQgXG4gICAgPyBCb29sZWFuKEVOQUJMRV9FWEVDVVRFID09PSAndHJ1ZScpXG4gICAgOiBlbmFibGVFeGVjdXRlRnJvbUNvbnRleHQgIT09IHVuZGVmaW5lZFxuICAgID8gQm9vbGVhbihlbmFibGVFeGVjdXRlRnJvbUNvbnRleHQpXG4gICAgOiBmYWxzZTtcblxuICBjb25zdCB1c2VBdXRoZW50aWtDb25maWdGaWxlID0gVVNFX0FVVEhFTlRJS19DT05GSUdfRklMRSAhPT0gdW5kZWZpbmVkXG4gICAgPyBCb29sZWFuKFVTRV9BVVRIRU5USUtfQ09ORklHX0ZJTEUgPT09ICd0cnVlJylcbiAgICA6IHVzZUF1dGhlbnRpa0NvbmZpZ0ZpbGVGcm9tQ29udGV4dCAhPT0gdW5kZWZpbmVkXG4gICAgPyBCb29sZWFuKHVzZUF1dGhlbnRpa0NvbmZpZ0ZpbGVGcm9tQ29udGV4dClcbiAgICA6IGZhbHNlO1xuXG4gIC8vIFN0cmluZyBwYXJhbWV0ZXJzIHdpdGggdmFsaWRhdGlvblxuICBjb25zdCBhdXRoZW50aWtBZG1pblVzZXJFbWFpbCA9IEFVVEhFTlRJS19BRE1JTl9VU0VSX0VNQUlMIHx8IGF1dGhlbnRpa0FkbWluVXNlckVtYWlsRnJvbUNvbnRleHQgfHwgJyc7XG4gIGNvbnN0IGF1dGhlbnRpa0xkYXBCYXNlRG4gPSBBVVRIRU5USUtfTERBUF9CQVNFX0ROIHx8IGF1dGhlbnRpa0xkYXBCYXNlRG5Gcm9tQ29udGV4dCB8fCAnREM9ZXhhbXBsZSxEQz1jb20nO1xuICBjb25zdCBpcEFkZHJlc3NUeXBlID0gKElQX0FERFJFU1NfVFlQRSB8fCBpcEFkZHJlc3NUeXBlRnJvbUNvbnRleHQgfHwgJ2R1YWxzdGFjaycpIGFzICdpcHY0JyB8ICdkdWFsc3RhY2snO1xuICBjb25zdCBzc2xDZXJ0aWZpY2F0ZUFybiA9IFNTTF9DRVJUSUZJQ0FURV9BUk4gfHwgc3NsQ2VydGlmaWNhdGVBcm5Gcm9tQ29udGV4dCB8fCAnJztcbiAgY29uc3QgZG9ja2VySW1hZ2VMb2NhdGlvbiA9IChET0NLRVJfSU1BR0VfTE9DQVRJT04gfHwgZG9ja2VySW1hZ2VMb2NhdGlvbkZyb21Db250ZXh0IHx8ICdHaXRodWInKSBhcyAnR2l0aHViJyB8ICdMb2NhbCBFQ1InO1xuICBcbiAgLy8gRm9yIExEQVAsIHRoZSBhdXRoZW50aWsgaG9zdCB3aWxsIGJlIGRlcml2ZWQgZnJvbSB0aGUgQXV0aGVudGlrIGNvbnN0cnVjdCB3aXRoaW4gdGhlIHNhbWUgc3RhY2tcbiAgLy8gVGhpcyBpcyBhIHBsYWNlaG9sZGVyIHRoYXQgZ2V0cyBvdmVycmlkZGVuIGR1cmluZyBzdGFjayBjb25zdHJ1Y3Rpb25cbiAgY29uc3QgYXV0aGVudGlrSG9zdCA9IHByb2Nlc3MuZW52LkFVVEhFTlRJS19IT1NUIHx8IGF1dGhlbnRpa0hvc3RGcm9tQ29udGV4dCB8fCAnbG9jYWxob3N0JztcblxuICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBwYXJhbWV0ZXJzXG4gIGlmICghYXV0aGVudGlrQWRtaW5Vc2VyRW1haWwpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ2F1dGhlbnRpa0FkbWluVXNlckVtYWlsIGlzIHJlcXVpcmVkLiBTZXQgaXQgdmlhIC0tY29udGV4dCBhdXRoZW50aWtBZG1pblVzZXJFbWFpbD11c2VyQGV4YW1wbGUuY29tIG9yIEFVVEhFTlRJS19BRE1JTl9VU0VSX0VNQUlMIGVudmlyb25tZW50IHZhcmlhYmxlLicpO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBlbnZUeXBlLFxuICAgIHN0YWNrTmFtZSxcbiAgICBnaXRTaGEsXG4gICAgZW5hYmxlRXhlY3V0ZSxcbiAgICBhdXRoZW50aWtBZG1pblVzZXJFbWFpbCxcbiAgICBhdXRoZW50aWtMZGFwQmFzZURuLFxuICAgIGlwQWRkcmVzc1R5cGUsXG4gICAgc3NsQ2VydGlmaWNhdGVBcm4sXG4gICAgdXNlQXV0aGVudGlrQ29uZmlnRmlsZSxcbiAgICBkb2NrZXJJbWFnZUxvY2F0aW9uLFxuICAgIGF1dGhlbnRpa0hvc3QsXG4gIH07XG59XG4iXX0=