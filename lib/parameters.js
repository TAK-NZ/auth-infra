"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DOCKER_IMAGE_LOCATION = exports.USE_AUTHENTIK_CONFIG_FILE = exports.SSL_CERTIFICATE_ARN = exports.IP_ADDRESS_TYPE = exports.AUTHENTIK_LDAP_BASE_DN = exports.AUTHENTIK_ADMIN_USER_EMAIL = exports.ENABLE_EXECUTE = exports.GIT_SHA = exports.ENV_TYPE = void 0;
exports.getGitSha = getGitSha;
exports.getParameters = getParameters;
exports.resolveStackParameters = resolveStackParameters;
const child_process_1 = require("child_process");
const environment_config_1 = require("./environment-config");
// Direct parameter exports following the reference pattern
exports.ENV_TYPE = process.env.ENV_TYPE || 'dev-test';
exports.GIT_SHA = process.env.GIT_SHA;
exports.ENABLE_EXECUTE = process.env.ENABLE_EXECUTE;
exports.AUTHENTIK_ADMIN_USER_EMAIL = process.env.AUTHENTIK_ADMIN_USER_EMAIL;
exports.AUTHENTIK_LDAP_BASE_DN = process.env.AUTHENTIK_LDAP_BASE_DN;
exports.IP_ADDRESS_TYPE = process.env.IP_ADDRESS_TYPE;
exports.SSL_CERTIFICATE_ARN = process.env.SSL_CERTIFICATE_ARN;
exports.USE_AUTHENTIK_CONFIG_FILE = process.env.USE_AUTHENTIK_CONFIG_FILE;
exports.DOCKER_IMAGE_LOCATION = process.env.DOCKER_IMAGE_LOCATION;
/**
 * Get the current git SHA for tagging resources
 * @returns Current git SHA
 */
function getGitSha() {
    try {
        // Get the current git SHA
        return (0, child_process_1.execSync)('git rev-parse --short HEAD').toString().trim();
    }
    catch (error) {
        console.warn('Unable to get git SHA, using "development"');
        return 'development';
    }
}
function getParameters() {
    return {
        envType: exports.ENV_TYPE,
        gitSha: exports.GIT_SHA || getGitSha(),
        enableExecute: exports.ENABLE_EXECUTE === 'true' || false,
    };
}
/**
 * Resolves all AuthInfra stack parameters using cascading resolution
 * Priority: 1. Environment Variables, 2. CDK Context, 3. Default Values
 */
function resolveStackParameters(stack) {
    // Environment variables (first priority)
    const STACK_NAME_ENV = process.env.STACK_NAME;
    // Context values (second priority)
    const envTypeFromContext = stack.node.tryGetContext('envType');
    const stackNameFromContext = stack.node.tryGetContext('stackName');
    const gitShaFromContext = stack.node.tryGetContext('gitSha');
    const enableExecuteFromContext = stack.node.tryGetContext('enableExecute');
    const authentikAdminUserEmailFromContext = stack.node.tryGetContext('authentikAdminUserEmail');
    const authentikLdapBaseDnFromContext = stack.node.tryGetContext('authentikLdapBaseDn');
    const ipAddressTypeFromContext = stack.node.tryGetContext('ipAddressType');
    const sslCertificateArnFromContext = stack.node.tryGetContext('sslCertificateArn');
    const useAuthentikConfigFileFromContext = stack.node.tryGetContext('useAuthentikConfigFile');
    const dockerImageLocationFromContext = stack.node.tryGetContext('dockerImageLocation');
    const authentikHostFromContext = stack.node.tryGetContext('authentikHost');
    // Resolution with environment variables taking precedence
    const envType = process.env.ENV_TYPE || envTypeFromContext || 'dev-test';
    const stackName = STACK_NAME_ENV || stackNameFromContext || 'MyFirstStack';
    const gitSha = exports.GIT_SHA || gitShaFromContext || getGitSha();
    // Get environment-specific configuration
    const envConfig = (0, environment_config_1.getEnvironmentConfig)(envType);
    // Boolean parameters: Environment variables override context, which overrides defaults
    const enableExecute = exports.ENABLE_EXECUTE !== undefined
        ? Boolean(exports.ENABLE_EXECUTE === 'true')
        : enableExecuteFromContext !== undefined
            ? Boolean(enableExecuteFromContext)
            : false;
    const useAuthentikConfigFile = exports.USE_AUTHENTIK_CONFIG_FILE !== undefined
        ? Boolean(exports.USE_AUTHENTIK_CONFIG_FILE === 'true')
        : useAuthentikConfigFileFromContext !== undefined
            ? Boolean(useAuthentikConfigFileFromContext)
            : false;
    // String parameters with validation
    const authentikAdminUserEmail = exports.AUTHENTIK_ADMIN_USER_EMAIL || authentikAdminUserEmailFromContext || '';
    const authentikLdapBaseDn = exports.AUTHENTIK_LDAP_BASE_DN || authentikLdapBaseDnFromContext || 'DC=example,DC=com';
    const ipAddressType = (exports.IP_ADDRESS_TYPE || ipAddressTypeFromContext || 'dualstack');
    const sslCertificateArn = exports.SSL_CERTIFICATE_ARN || sslCertificateArnFromContext || '';
    const dockerImageLocation = (exports.DOCKER_IMAGE_LOCATION || dockerImageLocationFromContext || 'Github');
    // For LDAP, the authentik host will be derived from the Authentik construct within the same stack
    // This is a placeholder that gets overridden during stack construction
    const authentikHost = process.env.AUTHENTIK_HOST || authentikHostFromContext || 'localhost';
    // Validate required parameters
    if (!authentikAdminUserEmail) {
        throw new Error('authentikAdminUserEmail is required. Set it via --context authentikAdminUserEmail=user@example.com or AUTHENTIK_ADMIN_USER_EMAIL environment variable.');
    }
    return {
        envType,
        stackName,
        gitSha,
        enableExecute,
        authentikAdminUserEmail,
        authentikLdapBaseDn,
        ipAddressType,
        sslCertificateArn,
        useAuthentikConfigFile,
        dockerImageLocation,
        authentikHost,
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyYW1ldGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInBhcmFtZXRlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBc0JBLDhCQVFDO0FBRUQsc0NBTUM7QUFNRCx3REErRUM7QUF2SEQsaURBQXlDO0FBQ3pDLDZEQUE0RDtBQUU1RCwyREFBMkQ7QUFDOUMsUUFBQSxRQUFRLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUErQixJQUFJLFVBQVUsQ0FBQztBQUNyRSxRQUFBLE9BQU8sR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQztBQUM5QixRQUFBLGNBQWMsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQztBQUM1QyxRQUFBLDBCQUEwQixHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsMEJBQTBCLENBQUM7QUFDcEUsUUFBQSxzQkFBc0IsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLHNCQUFzQixDQUFDO0FBQzVELFFBQUEsZUFBZSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBZSxDQUFDO0FBQzlDLFFBQUEsbUJBQW1CLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQztBQUN0RCxRQUFBLHlCQUF5QixHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMseUJBQXlCLENBQUM7QUFDbEUsUUFBQSxxQkFBcUIsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDO0FBRXZFOzs7R0FHRztBQUNILFNBQWdCLFNBQVM7SUFDdkIsSUFBSSxDQUFDO1FBQ0gsMEJBQTBCO1FBQzFCLE9BQU8sSUFBQSx3QkFBUSxFQUFDLDRCQUE0QixDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDbEUsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZixPQUFPLENBQUMsSUFBSSxDQUFDLDRDQUE0QyxDQUFDLENBQUM7UUFDM0QsT0FBTyxhQUFhLENBQUM7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LG1CQUFtQixDQUFDO0lBQzVHLE1BQU0sYUFBYSxHQUFHLENBQUMsdUJBQWUsSUFBSSx3QkFBd0IsSUFBSSxXQUFXLENBQXlCLENBQUM7SUFDM0csTUFBTSxpQkFBaUIsR0FBRywyQkFBbUIsSUFBSSw0QkFBNEIsSUFBSSxFQUFFLENBQUM7SUFDcEYsTUFBTSxtQkFBbUIsR0FBRyxDQUFDLDZCQUFxQixJQUFJLDhCQUE4QixJQUFJLFFBQVEsQ0FBMkIsQ0FBQztJQUU1SCxrR0FBa0c7SUFDbEcsdUVBQXVFO0lBQ3ZFLE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxJQUFJLHdCQUF3QixJQUFJLFdBQVcsQ0FBQztJQUU1RiwrQkFBK0I7SUFDL0IsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUM7UUFDN0IsTUFBTSxJQUFJLEtBQUssQ0FBQyx3SkFBd0osQ0FBQyxDQUFDO0lBQzVLLENBQUM7SUFFRCxPQUFPO1FBQ0wsT0FBTztRQUNQLFNBQVM7UUFDVCxNQUFNO1FBQ04sYUFBYTtRQUNiLHVCQUF1QjtRQUN2QixtQkFBbUI7UUFDbkIsYUFBYTtRQUNiLGlCQUFpQjtRQUNqQixzQkFBc0I7UUFDdEIsbUJBQW1CO1FBQ25CLGFBQWE7S0FDZCxDQUFDO0FBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogUGFyYW1ldGVyIGhhbmRsaW5nIGFuZCBlbnZpcm9ubWVudCB2YXJpYWJsZSByZXNvbHV0aW9uIGZvciB0aGUgQXV0aEluZnJhIHN0YWNrXG4gKi9cbmltcG9ydCAqIGFzIGNkayBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0IHsgZ2V0RW52aXJvbm1lbnRDb25maWcgfSBmcm9tICcuL2Vudmlyb25tZW50LWNvbmZpZyc7XG5cbi8vIERpcmVjdCBwYXJhbWV0ZXIgZXhwb3J0cyBmb2xsb3dpbmcgdGhlIHJlZmVyZW5jZSBwYXR0ZXJuXG5leHBvcnQgY29uc3QgRU5WX1RZUEUgPSBwcm9jZXNzLmVudi5FTlZfVFlQRSBhcyAncHJvZCcgfCAnZGV2LXRlc3QnIHx8ICdkZXYtdGVzdCc7XG5leHBvcnQgY29uc3QgR0lUX1NIQSA9IHByb2Nlc3MuZW52LkdJVF9TSEE7XG5leHBvcnQgY29uc3QgRU5BQkxFX0VYRUNVVEUgPSBwcm9jZXNzLmVudi5FTkFCTEVfRVhFQ1VURTtcbmV4cG9ydCBjb25zdCBBVVRIRU5USUtfQURNSU5fVVNFUl9FTUFJTCA9IHByb2Nlc3MuZW52LkFVVEhFTlRJS19BRE1JTl9VU0VSX0VNQUlMO1xuZXhwb3J0IGNvbnN0IEFVVEhFTlRJS19MREFQX0JBU0VfRE4gPSBwcm9jZXNzLmVudi5BVVRIRU5USUtfTERBUF9CQVNFX0ROO1xuZXhwb3J0IGNvbnN0IElQX0FERFJFU1NfVFlQRSA9IHByb2Nlc3MuZW52LklQX0FERFJFU1NfVFlQRTtcbmV4cG9ydCBjb25zdCBTU0xfQ0VSVElGSUNBVEVfQVJOID0gcHJvY2Vzcy5lbnYuU1NMX0NFUlRJRklDQVRFX0FSTjtcbmV4cG9ydCBjb25zdCBVU0VfQVVUSEVOVElLX0NPTkZJR19GSUxFID0gcHJvY2Vzcy5lbnYuVVNFX0FVVEhFTlRJS19DT05GSUdfRklMRTtcbmV4cG9ydCBjb25zdCBET0NLRVJfSU1BR0VfTE9DQVRJT04gPSBwcm9jZXNzLmVudi5ET0NLRVJfSU1BR0VfTE9DQVRJT047XG5cbi8qKlxuICogR2V0IHRoZSBjdXJyZW50IGdpdCBTSEEgZm9yIHRhZ2dpbmcgcmVzb3VyY2VzXG4gKiBAcmV0dXJucyBDdXJyZW50IGdpdCBTSEFcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEdpdFNoYSgpOiBzdHJpbmcge1xuICB0cnkge1xuICAgIC8vIEdldCB0aGUgY3VycmVudCBnaXQgU0hBXG4gICAgcmV0dXJuIGV4ZWNTeW5jKCdnaXQgcmV2LXBhcnNlIC0tc2hvcnQgSEVBRCcpLnRvU3RyaW5nKCkudHJpbSgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUud2FybignVW5hYmxlIHRvIGdldCBnaXQgU0hBLCB1c2luZyBcImRldmVsb3BtZW50XCInKTtcbiAgICByZXR1cm4gJ2RldmVsb3BtZW50JztcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0UGFyYW1ldGVycygpIHtcbiAgcmV0dXJuIHtcbiAgICBlbnZUeXBlOiBFTlZfVFlQRSxcbiAgICBnaXRTaGE6IEdJVF9TSEEgfHwgZ2V0R2l0U2hhKCksXG4gICAgZW5hYmxlRXhlY3V0ZTogRU5BQkxFX0VYRUNVVEUgPT09ICd0cnVlJyB8fCBmYWxzZSxcbiAgfTtcbn1cblxuLyoqXG4gKiBSZXNvbHZlcyBhbGwgQXV0aEluZnJhIHN0YWNrIHBhcmFtZXRlcnMgdXNpbmcgY2FzY2FkaW5nIHJlc29sdXRpb25cbiAqIFByaW9yaXR5OiAxLiBFbnZpcm9ubWVudCBWYXJpYWJsZXMsIDIuIENESyBDb250ZXh0LCAzLiBEZWZhdWx0IFZhbHVlc1xuICovXG5leHBvcnQgZnVuY3Rpb24gcmVzb2x2ZVN0YWNrUGFyYW1ldGVycyhzdGFjazogY2RrLlN0YWNrKToge1xuICBlbnZUeXBlOiBzdHJpbmc7XG4gIHN0YWNrTmFtZTogc3RyaW5nO1xuICBnaXRTaGE6IHN0cmluZztcbiAgZW5hYmxlRXhlY3V0ZTogYm9vbGVhbjtcbiAgYXV0aGVudGlrQWRtaW5Vc2VyRW1haWw6IHN0cmluZztcbiAgYXV0aGVudGlrTGRhcEJhc2VEbjogc3RyaW5nO1xuICBpcEFkZHJlc3NUeXBlOiAnaXB2NCcgfCAnZHVhbHN0YWNrJztcbiAgc3NsQ2VydGlmaWNhdGVBcm46IHN0cmluZztcbiAgdXNlQXV0aGVudGlrQ29uZmlnRmlsZTogYm9vbGVhbjtcbiAgZG9ja2VySW1hZ2VMb2NhdGlvbjogJ0dpdGh1YicgfCAnTG9jYWwgRUNSJztcbiAgYXV0aGVudGlrSG9zdDogc3RyaW5nO1xufSB7XG4gIC8vIEVudmlyb25tZW50IHZhcmlhYmxlcyAoZmlyc3QgcHJpb3JpdHkpXG4gIGNvbnN0IFNUQUNLX05BTUVfRU5WID0gcHJvY2Vzcy5lbnYuU1RBQ0tfTkFNRTtcbiAgXG4gIC8vIENvbnRleHQgdmFsdWVzIChzZWNvbmQgcHJpb3JpdHkpXG4gIGNvbnN0IGVudlR5cGVGcm9tQ29udGV4dCA9IHN0YWNrLm5vZGUudHJ5R2V0Q29udGV4dCgnZW52VHlwZScpO1xuICBjb25zdCBzdGFja05hbWVGcm9tQ29udGV4dCA9IHN0YWNrLm5vZGUudHJ5R2V0Q29udGV4dCgnc3RhY2tOYW1lJyk7XG4gIGNvbnN0IGdpdFNoYUZyb21Db250ZXh0ID0gc3RhY2subm9kZS50cnlHZXRDb250ZXh0KCdnaXRTaGEnKTtcbiAgY29uc3QgZW5hYmxlRXhlY3V0ZUZyb21Db250ZXh0ID0gc3RhY2subm9kZS50cnlHZXRDb250ZXh0KCdlbmFibGVFeGVjdXRlJyk7XG4gIGNvbnN0IGF1dGhlbnRpa0FkbWluVXNlckVtYWlsRnJvbUNvbnRleHQgPSBzdGFjay5ub2RlLnRyeUdldENvbnRleHQoJ2F1dGhlbnRpa0FkbWluVXNlckVtYWlsJyk7XG4gIGNvbnN0IGF1dGhlbnRpa0xkYXBCYXNlRG5Gcm9tQ29udGV4dCA9IHN0YWNrLm5vZGUudHJ5R2V0Q29udGV4dCgnYXV0aGVudGlrTGRhcEJhc2VEbicpO1xuICBjb25zdCBpcEFkZHJlc3NUeXBlRnJvbUNvbnRleHQgPSBzdGFjay5ub2RlLnRyeUdldENvbnRleHQoJ2lwQWRkcmVzc1R5cGUnKTtcbiAgY29uc3Qgc3NsQ2VydGlmaWNhdGVBcm5Gcm9tQ29udGV4dCA9IHN0YWNrLm5vZGUudHJ5R2V0Q29udGV4dCgnc3NsQ2VydGlmaWNhdGVBcm4nKTtcbiAgY29uc3QgdXNlQXV0aGVudGlrQ29uZmlnRmlsZUZyb21Db250ZXh0ID0gc3RhY2subm9kZS50cnlHZXRDb250ZXh0KCd1c2VBdXRoZW50aWtDb25maWdGaWxlJyk7XG4gIGNvbnN0IGRvY2tlckltYWdlTG9jYXRpb25Gcm9tQ29udGV4dCA9IHN0YWNrLm5vZGUudHJ5R2V0Q29udGV4dCgnZG9ja2VySW1hZ2VMb2NhdGlvbicpO1xuICBjb25zdCBhdXRoZW50aWtIb3N0RnJvbUNvbnRleHQgPSBzdGFjay5ub2RlLnRyeUdldENvbnRleHQoJ2F1dGhlbnRpa0hvc3QnKTtcblxuICAvLyBSZXNvbHV0aW9uIHdpdGggZW52aXJvbm1lbnQgdmFyaWFibGVzIHRha2luZyBwcmVjZWRlbmNlXG4gIGNvbnN0IGVudlR5cGUgPSBwcm9jZXNzLmVudi5FTlZfVFlQRSB8fCBlbnZUeXBlRnJvbUNvbnRleHQgfHwgJ2Rldi10ZXN0JztcbiAgY29uc3Qgc3RhY2tOYW1lID0gU1RBQ0tfTkFNRV9FTlYgfHwgc3RhY2tOYW1lRnJvbUNvbnRleHQgfHwgJ015Rmlyc3RTdGFjayc7XG4gIGNvbnN0IGdpdFNoYSA9IEdJVF9TSEEgfHwgZ2l0U2hhRnJvbUNvbnRleHQgfHwgZ2V0R2l0U2hhKCk7XG5cbiAgLy8gR2V0IGVudmlyb25tZW50LXNwZWNpZmljIGNvbmZpZ3VyYXRpb25cbiAgY29uc3QgZW52Q29uZmlnID0gZ2V0RW52aXJvbm1lbnRDb25maWcoZW52VHlwZSk7XG5cbiAgLy8gQm9vbGVhbiBwYXJhbWV0ZXJzOiBFbnZpcm9ubWVudCB2YXJpYWJsZXMgb3ZlcnJpZGUgY29udGV4dCwgd2hpY2ggb3ZlcnJpZGVzIGRlZmF1bHRzXG4gIGNvbnN0IGVuYWJsZUV4ZWN1dGUgPSBFTkFCTEVfRVhFQ1VURSAhPT0gdW5kZWZpbmVkIFxuICAgID8gQm9vbGVhbihFTkFCTEVfRVhFQ1VURSA9PT0gJ3RydWUnKVxuICAgIDogZW5hYmxlRXhlY3V0ZUZyb21Db250ZXh0ICE9PSB1bmRlZmluZWRcbiAgICA/IEJvb2xlYW4oZW5hYmxlRXhlY3V0ZUZyb21Db250ZXh0KVxuICAgIDogZmFsc2U7XG5cbiAgY29uc3QgdXNlQXV0aGVudGlrQ29uZmlnRmlsZSA9IFVTRV9BVVRIRU5USUtfQ09ORklHX0ZJTEUgIT09IHVuZGVmaW5lZFxuICAgID8gQm9vbGVhbihVU0VfQVVUSEVOVElLX0NPTkZJR19GSUxFID09PSAndHJ1ZScpXG4gICAgOiB1c2VBdXRoZW50aWtDb25maWdGaWxlRnJvbUNvbnRleHQgIT09IHVuZGVmaW5lZFxuICAgID8gQm9vbGVhbih1c2VBdXRoZW50aWtDb25maWdGaWxlRnJvbUNvbnRleHQpXG4gICAgOiBmYWxzZTtcblxuICAvLyBTdHJpbmcgcGFyYW1ldGVycyB3aXRoIHZhbGlkYXRpb25cbiAgY29uc3QgYXV0aGVudGlrQWRtaW5Vc2VyRW1haWwgPSBBVVRIRU5USUtfQURNSU5fVVNFUl9FTUFJTCB8fCBhdXRoZW50aWtBZG1pblVzZXJFbWFpbEZyb21Db250ZXh0IHx8ICcnO1xuICBjb25zdCBhdXRoZW50aWtMZGFwQmFzZURuID0gQVVUSEVOVElLX0xEQVBfQkFTRV9ETiB8fCBhdXRoZW50aWtMZGFwQmFzZURuRnJvbUNvbnRleHQgfHwgJ0RDPWV4YW1wbGUsREM9Y29tJztcbiAgY29uc3QgaXBBZGRyZXNzVHlwZSA9IChJUF9BRERSRVNTX1RZUEUgfHwgaXBBZGRyZXNzVHlwZUZyb21Db250ZXh0IHx8ICdkdWFsc3RhY2snKSBhcyAnaXB2NCcgfCAnZHVhbHN0YWNrJztcbiAgY29uc3Qgc3NsQ2VydGlmaWNhdGVBcm4gPSBTU0xfQ0VSVElGSUNBVEVfQVJOIHx8IHNzbENlcnRpZmljYXRlQXJuRnJvbUNvbnRleHQgfHwgJyc7XG4gIGNvbnN0IGRvY2tlckltYWdlTG9jYXRpb24gPSAoRE9DS0VSX0lNQUdFX0xPQ0FUSU9OIHx8IGRvY2tlckltYWdlTG9jYXRpb25Gcm9tQ29udGV4dCB8fCAnR2l0aHViJykgYXMgJ0dpdGh1YicgfCAnTG9jYWwgRUNSJztcbiAgXG4gIC8vIEZvciBMREFQLCB0aGUgYXV0aGVudGlrIGhvc3Qgd2lsbCBiZSBkZXJpdmVkIGZyb20gdGhlIEF1dGhlbnRpayBjb25zdHJ1Y3Qgd2l0aGluIHRoZSBzYW1lIHN0YWNrXG4gIC8vIFRoaXMgaXMgYSBwbGFjZWhvbGRlciB0aGF0IGdldHMgb3ZlcnJpZGRlbiBkdXJpbmcgc3RhY2sgY29uc3RydWN0aW9uXG4gIGNvbnN0IGF1dGhlbnRpa0hvc3QgPSBwcm9jZXNzLmVudi5BVVRIRU5USUtfSE9TVCB8fCBhdXRoZW50aWtIb3N0RnJvbUNvbnRleHQgfHwgJ2xvY2FsaG9zdCc7XG5cbiAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgcGFyYW1ldGVyc1xuICBpZiAoIWF1dGhlbnRpa0FkbWluVXNlckVtYWlsKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdhdXRoZW50aWtBZG1pblVzZXJFbWFpbCBpcyByZXF1aXJlZC4gU2V0IGl0IHZpYSAtLWNvbnRleHQgYXV0aGVudGlrQWRtaW5Vc2VyRW1haWw9dXNlckBleGFtcGxlLmNvbSBvciBBVVRIRU5USUtfQURNSU5fVVNFUl9FTUFJTCBlbnZpcm9ubWVudCB2YXJpYWJsZS4nKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgZW52VHlwZSxcbiAgICBzdGFja05hbWUsXG4gICAgZ2l0U2hhLFxuICAgIGVuYWJsZUV4ZWN1dGUsXG4gICAgYXV0aGVudGlrQWRtaW5Vc2VyRW1haWwsXG4gICAgYXV0aGVudGlrTGRhcEJhc2VEbixcbiAgICBpcEFkZHJlc3NUeXBlLFxuICAgIHNzbENlcnRpZmljYXRlQXJuLFxuICAgIHVzZUF1dGhlbnRpa0NvbmZpZ0ZpbGUsXG4gICAgZG9ja2VySW1hZ2VMb2NhdGlvbixcbiAgICBhdXRoZW50aWtIb3N0LFxuICB9O1xufVxuIl19