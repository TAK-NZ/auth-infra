import { execSync } from 'child_process';
/**
 * Get the current git SHA for tagging resources
 * @returns Current git SHA
 */
export function getGitSha() {
    try {
        // Get the current git SHA
        return execSync('git rev-parse --short HEAD').toString().trim();
    }
    catch (error) {
        console.warn('Unable to get git SHA, using "development"');
        return 'development';
    }
}
/**
 * Resolve Auth Infrastructure parameters from environment variables and CDK context
 * @param app - CDK App instance
 * @param stackName - The name of the stack
 * @param envType - The environment type (prod or dev-test)
 * @returns Resolved parameters for auth infrastructure stack
 */
export function resolveAuthInfraParameters(app, stackName, envType) {
    return {
        gitSha: getGitSha(),
        environment: stackName,
        envType: envType,
        enableExecute: app.node.tryGetContext('enableExecute') === 'true' ||
            process.env.ENABLE_EXECUTE === 'true' ||
            false,
        sslCertificateArn: app.node.tryGetContext('sslCertificateArn') ||
            process.env.SSL_CERTIFICATE_ARN ||
            '',
        authentikAdminUserEmail: app.node.tryGetContext('authentikAdminUserEmail') ||
            process.env.AUTHENTIK_ADMIN_USER_EMAIL ||
            '',
        authentikLdapBaseDn: app.node.tryGetContext('authentikLdapBaseDn') ||
            process.env.AUTHENTIK_LDAP_BASE_DN ||
            'DC=example,DC=com',
        useAuthentikConfigFile: app.node.tryGetContext('useAuthentikConfigFile') === 'true' ||
            process.env.USE_AUTHENTIK_CONFIG_FILE === 'true' ||
            false,
        ipAddressType: (app.node.tryGetContext('ipAddressType') ||
            process.env.IP_ADDRESS_TYPE ||
            'dualstack'),
        dockerImageLocation: (app.node.tryGetContext('dockerImageLocation') ||
            process.env.DOCKER_IMAGE_LOCATION ||
            'Github'),
    };
}
/**
 * Resolve LDAP stack parameters from environment variables and CDK context
 * @param app - CDK App instance
 * @param stackName - The name of the stack
 * @param envType - The environment type (prod or dev-test)
 * @returns Resolved parameters for LDAP stack
 */
export function resolveLdapParameters(app, stackName, envType) {
    return {
        gitSha: getGitSha(),
        environment: stackName,
        envType: envType,
        enableExecute: app.node.tryGetContext('enableExecute') === 'true' ||
            process.env.ENABLE_EXECUTE === 'true' ||
            false,
        sslCertificateArn: app.node.tryGetContext('sslCertificateArn') ||
            process.env.SSL_CERTIFICATE_ARN ||
            '',
        authentikHost: app.node.tryGetContext('authentikHost') ||
            process.env.AUTHENTIK_HOST ||
            '',
        dockerImageLocation: (app.node.tryGetContext('dockerImageLocation') ||
            process.env.DOCKER_IMAGE_LOCATION ||
            'Github'),
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyYW1ldGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbInBhcmFtZXRlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBSUEsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQStCekM7OztHQUdHO0FBQ0gsTUFBTSxVQUFVLFNBQVM7SUFDdkIsSUFBSSxDQUFDO1FBQ0gsMEJBQTBCO1FBQzFCLE9BQU8sUUFBUSxDQUFDLDRCQUE0QixDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDbEUsQ0FBQztJQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7UUFDZixPQUFPLENBQUMsSUFBSSxDQUFDLDRDQUE0QyxDQUFDLENBQUM7UUFDM0QsT0FBTyxhQUFhLENBQUM7SUFDdkIsQ0FBQztBQUNILENBQUM7QUFFRDs7Ozs7O0dBTUc7QUFDSCxNQUFNLFVBQVUsMEJBQTBCLENBQ3hDLEdBQVEsRUFDUixTQUFpQixFQUNqQixPQUE0QjtJQUU1QixPQUFPO1FBQ0wsTUFBTSxFQUFFLFNBQVMsRUFBRTtRQUNuQixXQUFXLEVBQUUsU0FBUztRQUN0QixPQUFPLEVBQUUsT0FBTztRQUNoQixhQUFhLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDLEtBQUssTUFBTTtZQUNsRCxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsS0FBSyxNQUFNO1lBQ3JDLEtBQUs7UUFDcEIsaUJBQWlCLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsbUJBQW1CLENBQUM7WUFDM0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUI7WUFDL0IsRUFBRTtRQUNyQix1QkFBdUIsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyx5QkFBeUIsQ0FBQztZQUNsRCxPQUFPLENBQUMsR0FBRyxDQUFDLDBCQUEwQjtZQUN0QyxFQUFFO1FBQzFCLG1CQUFtQixFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLHFCQUFxQixDQUFDO1lBQzlDLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCO1lBQ2xDLG1CQUFtQjtRQUN2QyxzQkFBc0IsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyx3QkFBd0IsQ0FBQyxLQUFLLE1BQU07WUFDNUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5QkFBeUIsS0FBSyxNQUFNO1lBQ2hELEtBQUs7UUFDNUIsYUFBYSxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsZUFBZSxDQUFDO1lBQ3hDLE9BQU8sQ0FBQyxHQUFHLENBQUMsZUFBZTtZQUMzQixXQUFXLENBQXlCO1FBQ25ELG1CQUFtQixFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMscUJBQXFCLENBQUM7WUFDL0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUI7WUFDakMsUUFBUSxDQUEyQjtLQUN4RCxDQUFDO0FBQ0osQ0FBQztBQUVEOzs7Ozs7R0FNRztBQUNILE1BQU0sVUFBVSxxQkFBcUIsQ0FDbkMsR0FBUSxFQUNSLFNBQWlCLEVBQ2pCLE9BQTRCO0lBRTVCLE9BQU87UUFDTCxNQUFNLEVBQUUsU0FBUyxFQUFFO1FBQ25CLFdBQVcsRUFBRSxTQUFTO1FBQ3RCLE9BQU8sRUFBRSxPQUFPO1FBQ2hCLGFBQWEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsS0FBSyxNQUFNO1lBQ2xELE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxLQUFLLE1BQU07WUFDckMsS0FBSztRQUNwQixpQkFBaUIsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBQztZQUMzQyxPQUFPLENBQUMsR0FBRyxDQUFDLG1CQUFtQjtZQUMvQixFQUFFO1FBQ3JCLGFBQWEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUM7WUFDeEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjO1lBQzFCLEVBQUU7UUFDaEIsbUJBQW1CLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxxQkFBcUIsQ0FBQztZQUMvQyxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQjtZQUNqQyxRQUFRLENBQTJCO0tBQ3hELENBQUM7QUFDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQYXJhbWV0ZXIgaGFuZGxpbmcgYW5kIGVudmlyb25tZW50IHZhcmlhYmxlIHJlc29sdXRpb24gZm9yIHRoZSBDREsgc3RhY2tzXG4gKi9cbmltcG9ydCB7IEFwcCB9IGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5cbi8qKlxuICogQ29uZmlnIHBhcmFtZXRlcnMgZm9yIGF1dGggaW5mcmFzdHJ1Y3R1cmUgc3RhY2tcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBdXRoSW5mcmFQYXJhbWV0ZXJzIHtcbiAgZ2l0U2hhOiBzdHJpbmc7XG4gIGVudmlyb25tZW50OiBzdHJpbmc7XG4gIGVudlR5cGU6ICdwcm9kJyB8ICdkZXYtdGVzdCc7XG4gIGVuYWJsZUV4ZWN1dGU6IGJvb2xlYW47XG4gIHNzbENlcnRpZmljYXRlQXJuOiBzdHJpbmc7XG4gIGF1dGhlbnRpa0FkbWluVXNlckVtYWlsOiBzdHJpbmc7XG4gIGF1dGhlbnRpa0xkYXBCYXNlRG46IHN0cmluZztcbiAgdXNlQXV0aGVudGlrQ29uZmlnRmlsZTogYm9vbGVhbjtcbiAgaXBBZGRyZXNzVHlwZTogJ2lwdjQnIHwgJ2R1YWxzdGFjayc7XG4gIGRvY2tlckltYWdlTG9jYXRpb246ICdHaXRodWInIHwgJ0xvY2FsIEVDUic7XG59XG5cbi8qKlxuICogQ29uZmlnIHBhcmFtZXRlcnMgZm9yIExEQVAgc3RhY2tcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBMZGFwUGFyYW1ldGVycyB7XG4gIGdpdFNoYTogc3RyaW5nO1xuICBlbnZpcm9ubWVudDogc3RyaW5nO1xuICBlbnZUeXBlOiAncHJvZCcgfCAnZGV2LXRlc3QnO1xuICBlbmFibGVFeGVjdXRlOiBib29sZWFuO1xuICBzc2xDZXJ0aWZpY2F0ZUFybjogc3RyaW5nO1xuICBhdXRoZW50aWtIb3N0OiBzdHJpbmc7XG4gIGRvY2tlckltYWdlTG9jYXRpb246ICdHaXRodWInIHwgJ0xvY2FsIEVDUic7XG59XG5cbi8qKlxuICogR2V0IHRoZSBjdXJyZW50IGdpdCBTSEEgZm9yIHRhZ2dpbmcgcmVzb3VyY2VzXG4gKiBAcmV0dXJucyBDdXJyZW50IGdpdCBTSEFcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEdpdFNoYSgpOiBzdHJpbmcge1xuICB0cnkge1xuICAgIC8vIEdldCB0aGUgY3VycmVudCBnaXQgU0hBXG4gICAgcmV0dXJuIGV4ZWNTeW5jKCdnaXQgcmV2LXBhcnNlIC0tc2hvcnQgSEVBRCcpLnRvU3RyaW5nKCkudHJpbSgpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUud2FybignVW5hYmxlIHRvIGdldCBnaXQgU0hBLCB1c2luZyBcImRldmVsb3BtZW50XCInKTtcbiAgICByZXR1cm4gJ2RldmVsb3BtZW50JztcbiAgfVxufVxuXG4vKipcbiAqIFJlc29sdmUgQXV0aCBJbmZyYXN0cnVjdHVyZSBwYXJhbWV0ZXJzIGZyb20gZW52aXJvbm1lbnQgdmFyaWFibGVzIGFuZCBDREsgY29udGV4dFxuICogQHBhcmFtIGFwcCAtIENESyBBcHAgaW5zdGFuY2VcbiAqIEBwYXJhbSBzdGFja05hbWUgLSBUaGUgbmFtZSBvZiB0aGUgc3RhY2tcbiAqIEBwYXJhbSBlbnZUeXBlIC0gVGhlIGVudmlyb25tZW50IHR5cGUgKHByb2Qgb3IgZGV2LXRlc3QpXG4gKiBAcmV0dXJucyBSZXNvbHZlZCBwYXJhbWV0ZXJzIGZvciBhdXRoIGluZnJhc3RydWN0dXJlIHN0YWNrXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZXNvbHZlQXV0aEluZnJhUGFyYW1ldGVycyhcbiAgYXBwOiBBcHAsXG4gIHN0YWNrTmFtZTogc3RyaW5nLFxuICBlbnZUeXBlOiAncHJvZCcgfCAnZGV2LXRlc3QnXG4pOiBBdXRoSW5mcmFQYXJhbWV0ZXJzIHtcbiAgcmV0dXJuIHtcbiAgICBnaXRTaGE6IGdldEdpdFNoYSgpLFxuICAgIGVudmlyb25tZW50OiBzdGFja05hbWUsXG4gICAgZW52VHlwZTogZW52VHlwZSxcbiAgICBlbmFibGVFeGVjdXRlOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdlbmFibGVFeGVjdXRlJykgPT09ICd0cnVlJyB8fCBcbiAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmVudi5FTkFCTEVfRVhFQ1VURSA9PT0gJ3RydWUnIHx8IFxuICAgICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgIHNzbENlcnRpZmljYXRlQXJuOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdzc2xDZXJ0aWZpY2F0ZUFybicpIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmVudi5TU0xfQ0VSVElGSUNBVEVfQVJOIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAnJyxcbiAgICBhdXRoZW50aWtBZG1pblVzZXJFbWFpbDogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnYXV0aGVudGlrQWRtaW5Vc2VyRW1haWwnKSB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmVudi5BVVRIRU5USUtfQURNSU5fVVNFUl9FTUFJTCB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJyxcbiAgICBhdXRoZW50aWtMZGFwQmFzZURuOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdhdXRoZW50aWtMZGFwQmFzZURuJykgfHwgXG4gICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzLmVudi5BVVRIRU5USUtfTERBUF9CQVNFX0ROIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAgJ0RDPWV4YW1wbGUsREM9Y29tJyxcbiAgICB1c2VBdXRoZW50aWtDb25maWdGaWxlOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCd1c2VBdXRoZW50aWtDb25maWdGaWxlJykgPT09ICd0cnVlJyB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3MuZW52LlVTRV9BVVRIRU5USUtfQ09ORklHX0ZJTEUgPT09ICd0cnVlJyB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhbHNlLFxuICAgIGlwQWRkcmVzc1R5cGU6IChhcHAubm9kZS50cnlHZXRDb250ZXh0KCdpcEFkZHJlc3NUeXBlJykgfHwgXG4gICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5lbnYuSVBfQUREUkVTU19UWVBFIHx8IFxuICAgICAgICAgICAgICAgICAgICdkdWFsc3RhY2snKSBhcyAnaXB2NCcgfCAnZHVhbHN0YWNrJyxcbiAgICBkb2NrZXJJbWFnZUxvY2F0aW9uOiAoYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnZG9ja2VySW1hZ2VMb2NhdGlvbicpIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5lbnYuRE9DS0VSX0lNQUdFX0xPQ0FUSU9OIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAgJ0dpdGh1YicpIGFzICdHaXRodWInIHwgJ0xvY2FsIEVDUicsXG4gIH07XG59XG5cbi8qKlxuICogUmVzb2x2ZSBMREFQIHN0YWNrIHBhcmFtZXRlcnMgZnJvbSBlbnZpcm9ubWVudCB2YXJpYWJsZXMgYW5kIENESyBjb250ZXh0XG4gKiBAcGFyYW0gYXBwIC0gQ0RLIEFwcCBpbnN0YW5jZVxuICogQHBhcmFtIHN0YWNrTmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBzdGFja1xuICogQHBhcmFtIGVudlR5cGUgLSBUaGUgZW52aXJvbm1lbnQgdHlwZSAocHJvZCBvciBkZXYtdGVzdClcbiAqIEByZXR1cm5zIFJlc29sdmVkIHBhcmFtZXRlcnMgZm9yIExEQVAgc3RhY2tcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVMZGFwUGFyYW1ldGVycyhcbiAgYXBwOiBBcHAsXG4gIHN0YWNrTmFtZTogc3RyaW5nLFxuICBlbnZUeXBlOiAncHJvZCcgfCAnZGV2LXRlc3QnXG4pOiBMZGFwUGFyYW1ldGVycyB7XG4gIHJldHVybiB7XG4gICAgZ2l0U2hhOiBnZXRHaXRTaGEoKSxcbiAgICBlbnZpcm9ubWVudDogc3RhY2tOYW1lLFxuICAgIGVudlR5cGU6IGVudlR5cGUsXG4gICAgZW5hYmxlRXhlY3V0ZTogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnZW5hYmxlRXhlY3V0ZScpID09PSAndHJ1ZScgfHwgXG4gICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5lbnYuRU5BQkxFX0VYRUNVVEUgPT09ICd0cnVlJyB8fCBcbiAgICAgICAgICAgICAgICAgICBmYWxzZSxcbiAgICBzc2xDZXJ0aWZpY2F0ZUFybjogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnc3NsQ2VydGlmaWNhdGVBcm4nKSB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5lbnYuU1NMX0NFUlRJRklDQVRFX0FSTiB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgJycsXG4gICAgYXV0aGVudGlrSG9zdDogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnYXV0aGVudGlrSG9zdCcpIHx8IFxuICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5lbnYuQVVUSEVOVElLX0hPU1QgfHwgXG4gICAgICAgICAgICAgICAgICAnJyxcbiAgICBkb2NrZXJJbWFnZUxvY2F0aW9uOiAoYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnZG9ja2VySW1hZ2VMb2NhdGlvbicpIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzcy5lbnYuRE9DS0VSX0lNQUdFX0xPQ0FUSU9OIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAgJ0dpdGh1YicpIGFzICdHaXRodWInIHwgJ0xvY2FsIEVDUicsXG4gIH07XG59XG4iXX0=