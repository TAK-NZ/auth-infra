"use strict";
/**
 * Dynamic context override utilities
 * Simplified flat parameter system for command-line context overrides
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.applyContextOverrides = applyContextOverrides;
function applyContextOverrides(app, baseConfig) {
    const topLevelOverrides = {
        stackName: app.node.tryGetContext('stackName'),
    };
    return {
        ...baseConfig,
        ...Object.fromEntries(Object.entries(topLevelOverrides).filter(([_, v]) => v !== undefined)),
        database: {
            ...baseConfig.database,
            instanceClass: app.node.tryGetContext('instanceClass') ?? baseConfig.database.instanceClass,
            instanceCount: app.node.tryGetContext('instanceCount') ?? baseConfig.database.instanceCount,
            allocatedStorage: app.node.tryGetContext('allocatedStorage') ?? baseConfig.database.allocatedStorage,
            maxAllocatedStorage: app.node.tryGetContext('maxAllocatedStorage') ?? baseConfig.database.maxAllocatedStorage,
            enablePerformanceInsights: app.node.tryGetContext('enablePerformanceInsights') ?? baseConfig.database.enablePerformanceInsights,
            monitoringInterval: app.node.tryGetContext('monitoringInterval') ?? baseConfig.database.monitoringInterval,
            backupRetentionDays: app.node.tryGetContext('backupRetentionDays') ?? baseConfig.database.backupRetentionDays,
            deleteProtection: app.node.tryGetContext('deleteProtection') ?? baseConfig.database.deleteProtection,
        },
        redis: {
            ...baseConfig.redis,
            nodeType: app.node.tryGetContext('nodeType') ?? baseConfig.redis.nodeType,
            numCacheNodes: app.node.tryGetContext('numCacheNodes') ?? baseConfig.redis.numCacheNodes,
            enableTransit: app.node.tryGetContext('enableTransit') ?? baseConfig.redis.enableTransit,
            enableAtRest: app.node.tryGetContext('enableAtRest') ?? baseConfig.redis.enableAtRest,
        },
        ecs: {
            ...baseConfig.ecs,
            taskCpu: app.node.tryGetContext('taskCpu') ?? baseConfig.ecs.taskCpu,
            taskMemory: app.node.tryGetContext('taskMemory') ?? baseConfig.ecs.taskMemory,
            desiredCount: app.node.tryGetContext('desiredCount') ?? baseConfig.ecs.desiredCount,
            enableDetailedLogging: app.node.tryGetContext('enableDetailedLogging') ?? baseConfig.ecs.enableDetailedLogging,
        },
        authentik: {
            ...baseConfig.authentik,
            hostname: app.node.tryGetContext('authentikHostname') ?? baseConfig.authentik.hostname,
            adminUserEmail: app.node.tryGetContext('adminUserEmail') ?? baseConfig.authentik.adminUserEmail,
            ldapHostname: app.node.tryGetContext('ldapHostname') ?? baseConfig.authentik.ldapHostname,
            ldapBaseDn: app.node.tryGetContext('ldapBaseDn') ?? baseConfig.authentik.ldapBaseDn,
            useS3AuthentikConfigFile: app.node.tryGetContext('useS3AuthentikConfigFile') ?? baseConfig.authentik.useS3AuthentikConfigFile,
            enablePostgresReadReplicas: app.node.tryGetContext('enablePostgresReadReplicas') ?? baseConfig.authentik.enablePostgresReadReplicas,
        },
        general: {
            ...baseConfig.general,
            removalPolicy: app.node.tryGetContext('removalPolicy') || baseConfig.general.removalPolicy,
            enableDetailedLogging: app.node.tryGetContext('enableDetailedLogging') ?? baseConfig.general.enableDetailedLogging,
            enableContainerInsights: app.node.tryGetContext('enableContainerInsights') ?? baseConfig.general.enableContainerInsights,
        },
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGV4dC1vdmVycmlkZXMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJjb250ZXh0LW92ZXJyaWRlcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOztBQUtILHNEQW9EQztBQXBERCxTQUFnQixxQkFBcUIsQ0FDbkMsR0FBWSxFQUNaLFVBQW9DO0lBRXBDLE1BQU0saUJBQWlCLEdBQUc7UUFDeEIsU0FBUyxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQztLQUMvQyxDQUFDO0lBRUYsT0FBTztRQUNMLEdBQUcsVUFBVTtRQUNiLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsS0FBSyxTQUFTLENBQUMsQ0FBQztRQUM1RixRQUFRLEVBQUU7WUFDUixHQUFHLFVBQVUsQ0FBQyxRQUFRO1lBQ3RCLGFBQWEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxlQUFlLENBQUMsSUFBSSxVQUFVLENBQUMsUUFBUSxDQUFDLGFBQWE7WUFDM0YsYUFBYSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLGVBQWUsQ0FBQyxJQUFJLFVBQVUsQ0FBQyxRQUFRLENBQUMsYUFBYTtZQUMzRixnQkFBZ0IsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLFVBQVUsQ0FBQyxRQUFRLENBQUMsZ0JBQWdCO1lBQ3BHLG1CQUFtQixFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLHFCQUFxQixDQUFDLElBQUksVUFBVSxDQUFDLFFBQVEsQ0FBQyxtQkFBbUI7WUFDN0cseUJBQXlCLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsMkJBQTJCLENB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QyxhQUFhO1lBQzFGLHFCQUFxQixFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLHVCQUF1QixDQUFDLElBQUksVUFBVSxDQUFDLE9BQU8sQ0FBQyxxQkFBcUI7WUFDbEgsdUJBQXVCLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMseUJBQXlCLENBQUMsSUFBSSxVQUFVLENBQUMsT0FBTyxDQUFDLHVCQUF1QjtTQUN6SDtLQUNGLENBQUM7QUFDSixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBEeW5hbWljIGNvbnRleHQgb3ZlcnJpZGUgdXRpbGl0aWVzXG4gKiBTaW1wbGlmaWVkIGZsYXQgcGFyYW1ldGVyIHN5c3RlbSBmb3IgY29tbWFuZC1saW5lIGNvbnRleHQgb3ZlcnJpZGVzXG4gKi9cblxuaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7IENvbnRleHRFbnZpcm9ubWVudENvbmZpZyB9IGZyb20gJy4uL3N0YWNrLWNvbmZpZyc7XG5cbmV4cG9ydCBmdW5jdGlvbiBhcHBseUNvbnRleHRPdmVycmlkZXMoXG4gIGFwcDogY2RrLkFwcCwgXG4gIGJhc2VDb25maWc6IENvbnRleHRFbnZpcm9ubWVudENvbmZpZ1xuKTogQ29udGV4dEVudmlyb25tZW50Q29uZmlnIHtcbiAgY29uc3QgdG9wTGV2ZWxPdmVycmlkZXMgPSB7XG4gICAgc3RhY2tOYW1lOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdzdGFja05hbWUnKSxcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIC4uLmJhc2VDb25maWcsXG4gICAgLi4uT2JqZWN0LmZyb21FbnRyaWVzKE9iamVjdC5lbnRyaWVzKHRvcExldmVsT3ZlcnJpZGVzKS5maWx0ZXIoKFtfLCB2XSkgPT4gdiAhPT0gdW5kZWZpbmVkKSksXG4gICAgZGF0YWJhc2U6IHtcbiAgICAgIC4uLmJhc2VDb25maWcuZGF0YWJhc2UsXG4gICAgICBpbnN0YW5jZUNsYXNzOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdpbnN0YW5jZUNsYXNzJykgPz8gYmFzZUNvbmZpZy5kYXRhYmFzZS5pbnN0YW5jZUNsYXNzLFxuICAgICAgaW5zdGFuY2VDb3VudDogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnaW5zdGFuY2VDb3VudCcpID8/IGJhc2VDb25maWcuZGF0YWJhc2UuaW5zdGFuY2VDb3VudCxcbiAgICAgIGFsbG9jYXRlZFN0b3JhZ2U6IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ2FsbG9jYXRlZFN0b3JhZ2UnKSA/PyBiYXNlQ29uZmlnLmRhdGFiYXNlLmFsbG9jYXRlZFN0b3JhZ2UsXG4gICAgICBtYXhBbGxvY2F0ZWRTdG9yYWdlOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdtYXhBbGxvY2F0ZWRTdG9yYWdlJykgPz8gYmFzZUNvbmZpZy5kYXRhYmFzZS5tYXhBbGxvY2F0ZWRTdG9yYWdlLFxuICAgICAgZW5hYmxlUGVyZm9ybWFuY2VJbnNpZ2h0czogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnZW5hYmxlUGVyZm9ybWFuY2VJbnNpZ2h0cycpID8/IGJhc2VDb25maWcuZGF0YWJhc2UuZW5hYmxlUGVyZm9ybWFuY2VJbnNpZ2h0cyxcbiAgICAgIG1vbml0b3JpbmdJbnRlcnZhbDogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnbW9uaXRvcmluZ0ludGVydmFsJykgPz8gYmFzZUNvbmZpZy5kYXRhYmFzZS5tb25pdG9yaW5nSW50ZXJ2YWwsXG4gICAgICBiYWNrdXBSZXRlbnRpb25EYXlzOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdiYWNrdXBSZXRlbnRpb25EYXlzJykgPz8gYmFzZUNvbmZpZy5kYXRhYmFzZS5iYWNrdXBSZXRlbnRpb25EYXlzLFxuICAgICAgZGVsZXRlUHJvdGVjdGlvbjogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnZGVsZXRlUHJvdGVjdGlvbicpID8/IGJhc2VDb25maWcuZGF0YWJhc2UuZGVsZXRlUHJvdGVjdGlvbixcbiAgICB9LFxuICAgIHJlZGlzOiB7XG4gICAgICAuLi5iYXNlQ29uZmlnLnJlZGlzLFxuICAgICAgbm9kZVR5cGU6IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ25vZGVUeXBlJykgPz8gYmFzZUNvbmZpZy5yZWRpcy5ub2RlVHlwZSxcbiAgICAgIG51bUNhY2hlTm9kZXM6IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ251bUNhY2hlTm9kZXMnKSA/PyBiYXNlQ29uZmlnLnJlZGlzLm51bUNhY2hlTm9kZXMsXG4gICAgICBlbmFibGVUcmFuc2l0OiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdlbmFibGVUcmFuc2l0JykgPz8gYmFzZUNvbmZpZy5yZWRpcy5lbmFibGVUcmFuc2l0LFxuICAgICAgZW5hYmxlQXRSZXN0OiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdlbmFibGVBdFJlc3QnKSA/PyBiYXNlQ29uZmlnLnJlZGlzLmVuYWJsZUF0UmVzdCxcbiAgICB9LFxuICAgIGVjczoge1xuICAgICAgLi4uYmFzZUNvbmZpZy5lY3MsXG4gICAgICB0YXNrQ3B1OiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCd0YXNrQ3B1JykgPz8gYmFzZUNvbmZpZy5lY3MudGFza0NwdSxcbiAgICAgIHRhc2tNZW1vcnk6IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ3Rhc2tNZW1vcnknKSA/PyBiYXNlQ29uZmlnLmVjcy50YXNrTWVtb3J5LFxuICAgICAgZGVzaXJlZENvdW50OiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdkZXNpcmVkQ291bnQnKSA/PyBiYXNlQ29uZmlnLmVjcy5kZXNpcmVkQ291bnQsXG4gICAgICBlbmFibGVEZXRhaWxlZExvZ2dpbmc6IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ2VuYWJsZURldGFpbGVkTG9nZ2luZycpID8/IGJhc2VDb25maWcuZWNzLmVuYWJsZURldGFpbGVkTG9nZ2luZyxcbiAgICB9LFxuICAgIGF1dGhlbnRpazoge1xuICAgICAgLi4uYmFzZUNvbmZpZy5hdXRoZW50aWssXG4gICAgICBob3N0bmFtZTogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnYXV0aGVudGlrSG9zdG5hbWUnKSA/PyBiYXNlQ29uZmlnLmF1dGhlbnRpay5ob3N0bmFtZSxcbiAgICAgIGFkbWluVXNlckVtYWlsOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdhZG1pblVzZXJFbWFpbCcpID8/IGJhc2VDb25maWcuYXV0aGVudGlrLmFkbWluVXNlckVtYWlsLFxuICAgICAgbGRhcEhvc3RuYW1lOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdsZGFwSG9zdG5hbWUnKSA/PyBiYXNlQ29uZmlnLmF1dGhlbnRpay5sZGFwSG9zdG5hbWUsXG4gICAgICBsZGFwQmFzZURuOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdsZGFwQmFzZURuJykgPz8gYmFzZUNvbmZpZy5hdXRoZW50aWsubGRhcEJhc2VEbixcbiAgICAgIHVzZVMzQXV0aGVudGlrQ29uZmlnRmlsZTogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgndXNlUzNBdXRoZW50aWtDb25maWdGaWxlJykgPz8gYmFzZUNvbmZpZy5hdXRoZW50aWsudXNlUzNBdXRoZW50aWtDb25maWdGaWxlLFxuICAgICAgZW5hYmxlUG9zdGdyZXNSZWFkUmVwbGljYXM6IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ2VuYWJsZVBvc3RncmVzUmVhZFJlcGxpY2FzJykgPz8gYmFzZUNvbmZpZy5hdXRoZW50aWsuZW5hYmxlUG9zdGdyZXNSZWFkUmVwbGljYXMsXG4gICAgfSxcbiAgICBnZW5lcmFsOiB7XG4gICAgICAuLi5iYXNlQ29uZmlnLmdlbmVyYWwsXG4gICAgICByZW1vdmFsUG9saWN5OiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdyZW1vdmFsUG9saWN5JykgfHwgYmFzZUNvbmZpZy5nZW5lcmFsLnJlbW92YWxQb2xpY3ksXG4gICAgICBlbmFibGVEZXRhaWxlZExvZ2dpbmc6IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ2VuYWJsZURldGFpbGVkTG9nZ2luZycpID8/IGJhc2VDb25maWcuZ2VuZXJhbC5lbmFibGVEZXRhaWxlZExvZ2dpbmcsXG4gICAgICBlbmFibGVDb250YWluZXJJbnNpZ2h0czogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnZW5hYmxlQ29udGFpbmVySW5zaWdodHMnKSA/PyBiYXNlQ29uZmlnLmdlbmVyYWwuZW5hYmxlQ29udGFpbmVySW5zaWdodHMsXG4gICAgfSxcbiAgfTtcbn1cbiJdfQ==